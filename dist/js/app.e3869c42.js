(function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],h=0,d=[];h<s.length;h++)o=s[h],a[o]&&d.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(t);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={app:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"08e2":function(e,t,n){"use strict";var r=n("d081"),a=n.n(r);a.a},1390:function(e,t,n){"use strict";var r=n("3938"),a=n.n(r);a.a},"15d0":function(e,t,n){"use strict";var r=n("d559"),a=n.n(r);a.a},"17c5":function(e,t,n){"use strict";var r=n("7135"),a=n.n(r);a.a},"1c24":function(e,t,n){},"1e6b":function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="1e6b"},"21af":function(e,t,n){},"25e6":function(e,t,n){},2856:function(e,t,n){},"2b04":function(e,t,n){},3938:function(e,t,n){},4026:function(e,t,n){"use strict";var r=n("25e6"),a=n.n(r);a.a},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("097d");var r=n("2b0e"),a=n("5c96"),i=n.n(a),o=(n("0fae"),n("8c4f")),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{attrs:{id:"main"}},[n("side-bar",{directives:[{name:"show",rawName:"v-show",value:e.isShowSideBar,expression:"isShowSideBar"}],attrs:{id:"side-bar"}}),n("note-content",{class:{"zen-mode":e.isZenMode},attrs:{id:"note-content"}})],1),n("status-bar",{directives:[{name:"show",rawName:"v-show",value:e.isShowStatusBar,expression:"isShowStatusBar"}],attrs:{id:"status-bar"}}),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowBgImg,expression:"isShowBgImg"}],attrs:{id:"bgimg-container"}},[n("img",{attrs:{src:""+e.staticIconUrl+e.bgImgName+"."+e.bgImgFormat},on:{error:e.imgLoadError}})]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.$store.state.isProhibitOperation,expression:"$store.state.isProhibitOperation"}],ref:"modal",attrs:{id:"modal",tabindex:"1"}})],1)},c=[],l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"side-bar-small-mode":e.isSideBarSmallMode},attrs:{id:"side-bar"}},[n("div",{attrs:{id:"tool-icons"}},e._l(e.tools,function(t){return n("div",{directives:[{name:"show",rawName:"v-show",value:t.icon,expression:"t.icon"}],key:t.name,class:{"tool-icon":!0,active:t.name===e.activePage||e.activeButtons[t.name],"bottom-icon":t.isBottom},attrs:{title:t.name+(t.keyMap?" ("+t.keyMap.join("+")+")":"")},on:{click:function(n){e.changeTool(t)}}},[n("svg",{attrs:{viewBox:"0 0 1024 1024",version:"1.1"},domProps:{innerHTML:e._s(t.icon)}})])})),n("div",{attrs:{id:"tool-pages"}},[n("catalog",{directives:[{name:"show",rawName:"v-show",value:"Catalog"===e.activePage,expression:"activePage === 'Catalog'"}]}),"Search"===e.activePage?n("search"):e._e(),"Outline"===e.activePage?n("outline"):e._e(),"Todo"===e.activePage?n("todo"):e._e(),"Statistics"===e.activePage?n("statistics"):e._e()],1),e.isShowStickyNote?n("sticky-note"):e._e(),e.isShowSearchNoteBar?n("search-note-bar",{on:{close:function(t){e.isShowSearchNoteBar=!1}}}):e._e()],1)},u=[],h=(n("ac4d"),n("8a81"),n("ac6a"),n("7f7f"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isCatalogLoaded?n("div",{attrs:{id:"catalog"}},[n("ul",{staticClass:"catalog-container",attrs:{id:"catalog-level-1"},on:{contextmenu:function(t){e.showCatalogContextMenu(t,1)}}},e._l(e.catsLv1,function(t,r){return n("li",{key:t,class:{"cat-active":e.curCatLv1===t,"cat-dragover-active":2===e.draggedCatLv&&1===e.droppedCatLv&&e.droppedCatName===t,"cat-dragover-top-active":1===e.draggedCatLv&&1===e.droppedCatLv&&e.droppedCatName===t&&"TOP"===e.dropHalf,"cat-dragover-bottom-active":1===e.draggedCatLv&&1===e.droppedCatLv&&e.droppedCatName===t&&"BOTTOM"===e.dropHalf},attrs:{title:t,draggable:"true"},on:{click:function(n){e.changeCurCat(1,t)},contextmenu:function(n){e.showCatalogContextMenu(n,1,t,r)},dragstart:function(n){e.catalogDragStart(n,1,t,r)},dragend:function(t){e.catalogDragEnd(t)},dragenter:function(t){e.catalogDragEnterLv1(t)},dragover:function(n){e.catalogDragOverLv1(n,1,t,r)},dragleave:e.catalogDragLeave,drop:function(n){e.catalogDropLv1(n,1,t,r)}}},[e.isShowCatIcon?n("note-icon",{staticClass:"note-icon",attrs:{"icon-name":t}}):e._e(),e._v("\n      "+e._s(t)+"\n    ")],1)})),n("ul",{staticClass:"catalog-container",attrs:{id:"catalog-level-2"},on:{contextmenu:function(t){e.showCatalogContextMenu(t,2)}}},e._l(e.catsLv2,function(t,r){return n("li",{key:t,class:{"cat-active":e.curCatLv2===t,"cat-dragover-active":3===e.draggedCatLv&&2===e.droppedCatLv&&e.droppedCatName===t,"cat-dragover-top-active":2===e.draggedCatLv&&2===e.droppedCatLv&&e.droppedCatName===t&&"TOP"===e.dropHalf,"cat-dragover-bottom-active":2===e.draggedCatLv&&2===e.droppedCatLv&&e.droppedCatName===t&&"BOTTOM"===e.dropHalf},attrs:{title:t,draggable:"true"},on:{click:function(n){e.changeCurCat(2,t)},contextmenu:function(n){e.showCatalogContextMenu(n,2,t,r)},dragstart:function(n){e.catalogDragStart(n,2,t,r)},dragend:function(t){e.catalogDragEnd(t)},dragenter:function(t){e.catalogDragEnterLv2(t)},dragover:function(n){e.catalogDragOverLv2(n,2,t,r)},dragleave:e.catalogDragLeave,drop:function(n){e.catalogDropLv2(n,2,t,r)}}},[e.isShowCatIcon?n("note-icon",{staticClass:"note-icon",attrs:{"icon-name":t}}):e._e(),e._v("\n      "+e._s(t)+"\n    ")],1)})),n("ul",{staticClass:"catalog-container",attrs:{id:"catalog-level-3"},on:{contextmenu:function(t){e.showCatalogContextMenu(t,3)}}},e._l(e.catsLv3,function(t,r){return n("li",{key:t,class:{"cat-active":e.curCatLv3===t,"cat-dragover-top-active":3===e.draggedCatLv&&3===e.droppedCatLv&&e.droppedCatName===t&&"TOP"===e.dropHalf,"cat-dragover-bottom-active":3===e.draggedCatLv&&3===e.droppedCatLv&&e.droppedCatName===t&&"BOTTOM"===e.dropHalf},attrs:{title:t,draggable:"true"},on:{click:function(n){e.changeCurCat(3,t)},contextmenu:function(n){e.showCatalogContextMenu(n,3,t,r)},dragstart:function(n){e.catalogDragStart(n,3,t,r)},dragend:function(t){e.catalogDragEnd(t)},dragenter:function(t){e.catalogDragEnterLv3(t)},dragover:function(n){e.catalogDragOverLv3(n,3,t,r)},dragleave:e.catalogDragLeave,drop:function(n){e.catalogDropLv3(n,3,t,r)}}},[e.isShowCatIcon?n("note-icon",{staticClass:"note-icon",attrs:{"icon-name":t}}):e._e(),e._v("\n      "+e._s(t)+"\n    ")],1)})),n("content-menu",{directives:[{name:"show",rawName:"v-show",value:e.isShowContentMenu,expression:"isShowContentMenu"}],style:{left:e.contentMenuLeft,top:e.contentMenuTop}},[n("template",{slot:"menu-list"},e._l(e.curContentMenu,function(t){return n("li",{key:t,on:{click:function(n){e.handleContentMenu(t)}}},[e._v("\n        "+e._s(t)+"\n      ")])}))],2)],1):e._e()}),d=[],f=(n("4f7f"),n("6762"),n("2fdb"),n("456d"),n("9393")),g=(n("96cf"),n("3040")),v=n("6bde"),m=n("2ef0"),p=n.n(m),C=n("bc3a"),b=n.n(C),L="http://192.168.0.102",w={server:{serverUrl:"".concat(L,":12340/"),staticImageUrl:"".concat(L,":12340/images/"),staticIconUrl:"".concat(L,":12340/icons/")},defaultIconName:"__default__.png",bgImgName:"__background__"},y=w,x=y.server.serverUrl,S={get:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=null,e.next=3,b.a.get("".concat(x,"directories")).then(function(e){if(200!==e.status)throw t&&t.error("Directories.get(), Bad HTTP status: \n', ".concat(e.status)),new Error("Directories.get(), Bad HTTP status: \n', ".concat(e.status));n=e.data}).catch(function(e){throw t&&t.error("Directories.get() Error: ".concat(e)),new Error("Directories.get() Error: ".concat(e))});case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),create:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t&&"number"===typeof t.catLv&&"string"===typeof t.catName&&Array.isArray(t.catOrderAfterCreate)&&Array.isArray(t.ancestorCatNames)&&t.ancestorCatNames.length===t.catLv-1){e.next=2;break}throw new Error("Directories.create(), wrong parameters: ".concat(JSON.stringify(t)));case 2:if(new Set(t.catOrderAfterCreate).size===t.catOrderAfterCreate.length){e.next=4;break}throw new Error("Directories.create(), Duplicate file names exist: ".concat(JSON.stringify(t.catOrderAfterCreate)));case 4:return e.next=6,b.a.post("".concat(x,"directories"),JSON.stringify(t),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){if(200!==e.status)throw n&&n.error("Directories.create(), 创建目录失败"),new Error("Directories.create(), 创建目录失败 \n Bad Http Status: ".concat(e));console.log("[created catalog] Lv: ".concat(t.catLv,", name: ").concat(t.catName))}).catch(function(e){throw n&&n.error("Directories.create(), 创建目录失败"),new Error("Directories.create(), 创建目录失败 \n create Failed: ".concat(e))});case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),delete:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t&&Array.isArray(t)&&0!==t.length&&!(t.length>3)){e.next=2;break}throw new Error("Directories.delete(), wrong parameters: ".concat(JSON.stringify(t)));case 2:return e.next=4,b.a.delete("".concat(x,"directories"),{params:{paths:t}}).then(function(e){if(200!==e.status)throw n&&n.error("删除失败!"),new Error("Directories.delete(), 删除失败, Bad HTTP status: \n', ".concat(e.status));console.log("[deleted catalog] ".concat(t))}).catch(function(e){throw n&&n.error("删除失败!"),new Error("Directories.delete(), 删除失败, Error: ".concat(e))});case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),rename:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t&&Array.isArray(t.ancestorCatNames)&&Array.isArray(t.catOrderAfterRename)&&0!==t.catOrderAfterRename.length&&"string"===typeof t.oldName&&"string"===typeof t.newName){e.next=2;break}throw new Error("Directories.rename(), wrong parameters: ".concat(JSON.stringify(t)));case 2:if(new Set(t.catOrderAfterRename).size===t.catOrderAfterRename.length){e.next=4;break}throw new Error("Directories.rename(), Duplicate file names exist: ".concat(JSON.stringify(t.catOrderAfterRename)));case 4:return e.next=6,b.a.put("".concat(x,"directories"),JSON.stringify(t),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){if(200!==e.status)throw n&&n.error("目录重命名失败"),new Error("Directories.rename(), 目录重命名失败, Bad Http Status: ".concat(e));console.log("[renamed catalog]  path: ".concat(t.ancestorCatNames,", oldName: ").concat(t.oldName,", newName: ").concat(t.newName))}).catch(function(e){throw n&&n.error("目录重命名失败"),new Error("Directories.rename(), 目录重命名失败, create Failed: ".concat(e))});case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),reorder:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t&&"REORDER"===t.task&&"string"===typeof t.catName&&Array.isArray(t.affectedCatalogs)&&0!==t.affectedCatalogs){e.next=2;break}throw new Error("Directories.reorder(), wrong parameters: ".concat(JSON.stringify(t)));case 2:return t.affectedCatalogs.forEach(function(e){if(new Set(e.newCatOrder).size!==e.newCatOrder.length)throw new Error("Directories.reorder(), Duplicate file names exist in newCatOrder: ".concat(JSON.stringify(e)))}),e.next=5,b.a.put("".concat(x,"directories"),JSON.stringify(t),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){if(200!==e.status)throw n&&n.error("目录排序失败"),new Error("Directories.reorder(), 目录排序失败, Bad Http Status: ".concat(e));console.log("[reorder catalog]")}).catch(function(e){throw n&&n.error("目录排序失败"),new Error("Directories.reorder(), 目录排序失败, reorder Failed: ".concat(e))});case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},k=S,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{attrs:{id:"content-menu"}},[e._t("menu-list")],2)},O=[],N={name:"outline",data:function(){return{}},mounted:function(){}},T=N,_=(n("fbad"),n("2877")),I=Object(_["a"])(T,D,O,!1,null,"4c2f4670",null);I.options.__file="content-menu.vue";var R=I.exports,H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("img",{class:{"note-icon":!0,"no-default-icon":e.isDefaultIconNotFound},attrs:{src:""+e.staticIconUrl+e.iconName+".png"},on:{error:e.imgLoadError}})},F=[],j={name:"note-icon",data:function(){return{staticIconUrl:y.server.staticIconUrl,defaultIconUrl:"".concat(y.server.staticIconUrl).concat(y.defaultIconName),isDefaultIconTried:!1,isDefaultIconNotFound:!1}},props:{iconName:String},methods:{imgLoadError:function(e){this.isDefaultIconTried?(this.isDefaultIconNotFound=!0,console.warn("没有找到默认图标")):(e.target.src=this.defaultIconUrl,this.isDefaultIconTried=!0)}}},A=j,E=(n("a533"),Object(_["a"])(A,H,F,!1,null,"f609c7ce",null));E.options.__file="note-icon.vue";var P=E.exports,B=(n("a032"),n("4917"),{isFileNameValid:function(e){if("string"!==typeof e)return console.error("目录名不是string: ".concat(e)),"笔记名不是string";if(e.length<1)return"笔记名不能为空";if(e.length>200)return"笔记名不能超过200个字符";if(e.match(/^\d+$/))return"笔记名不能为纯数字";var t=!0,n=!1,r=void 0;try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(o.codePointAt(0)>65535)return"笔记名不能包含特殊字符"}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}if("."===e[0]||"."===e[e.length-1]||" "===e[0]||" "===e[e.length-1]||"\t"===e[0]||"\t"===e[e.length-1]||"\n"===e[0]||"\n"===e[e.length-1])return"笔记名不能以 . 空格 tab 换行符 开头或结尾";var s=/[<>:"/\\|?*]/;if(e.match(s))return'笔记名不能包含 < > : " / \\ | ? * 等特殊字符';var c=e.trim();return"_"!==c[0]||"_"!==c[1]||"_"!==c[c.length-1]||"_"!==c[c.length-2]||"笔记名不能以__开头的同时以__结尾"}}),M=B,$={name:"catalog",components:{ContentMenu:R,NoteIcon:P},data:function(){return{isCatalogLoaded:!1,curCatLv1:"",curCatLv2:"",curCatLv3:"",waitOpenCatLv1:"",waitOpenCatLv2:"",waitOpenCatLv3:"",catalog:[],catsLv1:[],catsLv2:[],catsLv3:[],isConAvailableLv2:!1,isConAvailableLv3:!1,isShowContentMenu:!1,contentMenuLeft:"",contentMenuTop:"",contentMenuCat:["create before","create after","rename","delete"],contentMenuContainer:["create"],curContentMenu:[],curContentMenuCatLv:null,curContentMenuCatName:null,curContentMenuCatIndex:null,draggedCatLv:null,draggedCatName:null,draggedCatIndex:null,droppedCatLv:null,droppedCatName:null,droppedCatIndex:null,catalogHalfHeight:null,dropHalf:null,catalogDragEnterLv1:null,catalogDragEnterLv2:null,catalogDragEnterLv3:null,catalogDragOverLv1:null,catalogDragOverLv2:null,catalogDragOverLv3:null,catalogDropLv1:null,catalogDropLv2:null,catalogDropLv3:null,isShowCatIcon:!0}},watch:{catalog:function(){this.updateCatalog(1)},curCatLv1:function(e){e&&"object"===Object(v["a"])(this.catalog[e])?(this.isConAvailableLv2=!0,this.updateCatalog(2)):this.isConAvailableLv2=!1},curCatLv2:function(e){e&&"object"===Object(v["a"])(this.catalog[this.curCatLv1][e])?(this.isConAvailableLv3=!0,this.updateCatalog(3)):this.isConAvailableLv3=!1},curCatLv3:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t||"object"!==Object(v["a"])(this.catalog[this.curCatLv1][this.curCatLv2][t])){e.next=3;break}return e.next=3,this.$store.state.editor.runCommand("OPENFILE","".concat(this.curCatLv1,"/").concat(this.curCatLv2,"/").concat(this.curCatLv3,"/").concat(this.curCatLv3,".md"));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),"$store.state.gotoThisCatalog":function(e){var t=this;if(this.$store.state.isProhibitOperation)this.$message.error("暂时不能操作目录");else if(this.$store.commit("updateIsProhibitOperation",!0),Array.isArray(e)){var n=Object(f["a"])(e,1);this.curCatLv1=n[0],setTimeout(function(){var n=Object(f["a"])(e,2);t.curCatLv2=n[1],setTimeout(function(){var n=Object(f["a"])(e,3);t.curCatLv3=n[2],t.$store.commit("updateIsProhibitOperation",!1)},0)},0)}}},methods:{getCatalog:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k.get(this.$message);case 2:this.catalog=e.sent,this.$store.commit("updateCatalog",p.a.cloneDeep(this.catalog)),this.isCatalogLoaded=!0,setTimeout(function(){if(t.waitOpenCatLv1)t.curCatLv1=t.waitOpenCatLv1;else if("object"===Object(v["a"])(t.catalog)){var e=Object.keys(t.catalog),n=Object(f["a"])(e,1);t.curCatLv1=n[0]}setTimeout(function(){if(t.waitOpenCatLv1)t.curCatLv2=t.waitOpenCatLv2;else if(t.curCatLv1&&"object"===Object(v["a"])(t.catalog[t.curCatLv1])){var e=Object.keys(t.catalog[t.curCatLv1]),n=Object(f["a"])(e,1);t.curCatLv2=n[0]}setTimeout(function(){if(t.waitOpenCatLv1)t.curCatLv3=t.waitOpenCatLv3;else if(t.curCatLv1&&t.curCatLv2&&"object"===Object(v["a"])(t.catalog[t.curCatLv1][t.curCatLv2])){var e=Object.keys(t.catalog[t.curCatLv1][t.curCatLv2]),n=Object(f["a"])(e,1);t.curCatLv3=n[0]}},0)},0)},0);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),updateCatalog:function(e){1===e?(this.curCatLv1="",this.curCatLv2="",this.curCatLv3="",this.catsLv1=this.catalog?Object.keys(this.catalog):[],this.catsLv2=[],this.catsLv3=[]):2===e?(this.curCatLv2="",this.curCatLv3="",this.catsLv2=this.curCatLv1&&"object"===Object(v["a"])(this.catalog[this.curCatLv1])?Object.keys(this.catalog[this.curCatLv1]):[],this.catsLv3=[]):3===e&&(this.curCatLv3=null,this.catsLv3=this.curCatLv2&&"object"===Object(v["a"])(this.catalog[this.curCatLv1][this.curCatLv2])?Object.keys(this.catalog[this.curCatLv1][this.curCatLv2]):[])},changeCurCat:function(e,t){1===e?this.curCatLv1=t:2===e?this.curCatLv2=t:3===e&&(this.curCatLv3=t)},showCatalogContextMenu:function(e,t,n,r){this.isShowContentMenu=!1,e.preventDefault(),e.stopPropagation(),t>1&&!this["isConAvailableLv".concat(t)]||(this.contentMenuLeft="".concat(e.clientX,"px"),this.contentMenuTop="".concat(e.clientY-8,"px"),t&&n?(this.curContentMenu=this.contentMenuCat,this.curContentMenuCatLv=t,this.curContentMenuCatName=n,this.curContentMenuCatIndex=r):(this.curContentMenu=this.contentMenuContainer,this.curContentMenuCatLv=t,this.curContentMenuCatName=null,this.curContentMenuCatIndex=null),this.isShowContentMenu=!0)},closeCatalogContextMenuOnClick:function(){var e=this;document.addEventListener("click",function(){e.curContentMenu=null,e.curContentMenuCatLv=null,e.curContentMenuCatName=null,e.curContentMenuCatIndex=null,e.isShowContentMenu=!1})},handleContentMenu:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.$store.state.editor){e.next=3;break}return this.$message({type:"warning",message:"编辑器还在加载中, 暂时不能使用右键菜单哦"}),e.abrupt("return");case 3:if(this.$store.commit("updateIsProhibitOperation",!0),"create"!==t&&"create before"!==t&&"create after"!==t){e.next=9;break}return e.next=7,this.createCat(t);case 7:e.next=17;break;case 9:if("delete"!==t){e.next=14;break}return e.next=12,this.deleteCat();case 12:e.next=17;break;case 14:if("rename"!==t){e.next=17;break}return e.next=17,this.rename();case 17:this.$store.commit("updateIsProhibitOperation",!1);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),createCat:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n,r,a,i,o,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=this.curContentMenuCatLv,r=this.curContentMenuCatIndex,a=!1,o=this["catsLv".concat(n)].map(function(e){return e.toLowerCase()}),e.next=6,this.$prompt("Create","",{center:!0,confirmButtonText:"Create",cancelButtonText:"Cancel",inputValidator:function(e){var t=M.isFileNameValid(e);return e?!0!==t?t:!o.includes(e.toLowerCase())||"目录名已存在":"目录名不能为空"}}).then(function(e){i=e.value}).catch(function(){a=!0});case 6:if(!a){e.next=8;break}return e.abrupt("return");case 8:if(s=[],"number"!==typeof r?(s=this["catsLv".concat(n)].slice(),s.push(i)):"create before"===t?(s=this["catsLv".concat(n)].slice(),s=[].concat(s.slice(0,r),i,s.slice(r))):"create after"===t&&(s=this["catsLv".concat(n)].slice(),s=[].concat(s.slice(0,r+1),i,s.slice(r+1))),!this.curCatLv3){e.next=13;break}return e.next=13,this.$store.state.editor.runCommand("SAVE",{triggerType:"CATALOG"});case 13:if(!this.curCatLv3||3===n){e.next=16;break}return e.next=16,this.$store.state.editor.runCommand("CLEAN");case 16:c=[],e.t0=n,e.next=2===e.t0?20:3===e.t0?22:25;break;case 20:return c.push(this.curCatLv1),e.abrupt("break",26);case 22:return c.push(this.curCatLv1),c.push(this.curCatLv2),e.abrupt("break",26);case 25:return e.abrupt("break",26);case 26:return l={catLv:n,catName:i,ancestorCatNames:c,catOrderAfterCreate:s},e.next=29,k.create(l,this.$message);case 29:e.t1=n,e.next=1===e.t1?32:2===e.t1?36:3===e.t1?40:44;break;case 32:return this.waitOpenCatLv1=i,this.waitOpenCatLv2="",this.waitOpenCatLv3="",e.abrupt("break",45);case 36:return this.waitOpenCatLv1=this.curCatLv1,this.waitOpenCatLv2=i,this.waitOpenCatLv3="",e.abrupt("break",45);case 40:return this.waitOpenCatLv1=this.curCatLv1,this.waitOpenCatLv2=this.curCatLv2,this.waitOpenCatLv3=i,e.abrupt("break",45);case 44:return e.abrupt("break",45);case 45:return e.next=47,this.getCatalog();case 47:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),deleteCat:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t,n,r,a,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=this.curContentMenuCatLv,n=this.curContentMenuCatName,r=!1,a=[],e.t0=t,e.next=1===e.t0?7:2===e.t0?10:3===e.t0?14:19;break;case 7:return a.push(n),this.curCatLv1===n&&this.curCatLv3&&(r=!0),e.abrupt("break",20);case 10:return a.push(this.curCatLv1),a.push(n),this.curCatLv2===n&&this.curCatLv3&&(r=!0),e.abrupt("break",20);case 14:return a.push(this.curCatLv1),a.push(this.curCatLv2),a.push(n),this.curCatLv3===n&&(r=!0),e.abrupt("break",20);case 19:return e.abrupt("break",20);case 20:return i=!1,e.next=23,this.$confirm("Delete ".concat(a.join("/")),"",{type:"warning",center:!0,confirmButtonText:"Delete",cancelButtonText:"Cancel"}).catch(function(){i=!0});case 23:if(!i){e.next=25;break}return e.abrupt("return");case 25:if(!r){e.next=30;break}return e.next=28,this.$store.state.editor.runCommand("CLEAN");case 28:e.next=33;break;case 30:if(!this.curCatLv3){e.next=33;break}return e.next=33,this.$store.state.editor.runCommand("SAVE",{triggerType:"CATALOG"});case 33:return e.next=35,k.delete(a,this.$message);case 35:e.t1=t,e.next=1===e.t1?38:2===e.t1?42:3===e.t1?46:50;break;case 38:return this.waitOpenCatLv1=this.curCatLv1===n?this.catsLv1[0]:this.curCatLv1,this.waitOpenCatLv2=this.curCatLv1===n?"":this.curCatLv2,this.waitOpenCatLv3=this.curCatLv1===n?"":this.curCatLv3,e.abrupt("break",51);case 42:return this.waitOpenCatLv1=this.curCatLv1,this.waitOpenCatLv2=this.curCatLv2===n?"":this.curCatLv2,this.waitOpenCatLv3=this.curCatLv2===n?"":this.curCatLv3,e.abrupt("break",51);case 46:return this.waitOpenCatLv1=this.curCatLv1,this.waitOpenCatLv2=this.curCatLv2,this.waitOpenCatLv3=this.curCatLv3===n?"":this.curCatLv3,e.abrupt("break",51);case 50:return e.abrupt("break",51);case 51:return e.next=53,this.getCatalog();case 53:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),rename:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t,n,r,a,i,o,s,c,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.curContentMenuCatLv,n=this.curContentMenuCatName,r=this.curContentMenuCatIndex,a="RENAME",i=!1,s=this["catsLv".concat(t)].map(function(e){return e.toLowerCase()}),e.next=8,this.$prompt("Rename: ".concat(n),"",{center:!0,confirmButtonText:"Rename",cancelButtonText:"Cancel",inputValidator:function(e){var t=M.isFileNameValid(e);return e?e===n?"新目录名和旧目录名一样":!0!==t?t:!s.includes(e.toLowerCase())||"目录名已存在":"目录名不能为空"}}).then(function(e){o=e.value}).catch(function(){i=!0});case 8:if(!i){e.next=10;break}return e.abrupt("return");case 10:c=[],e.t0=t,e.next=2===e.t0?14:3===e.t0?16:19;break;case 14:return c.push(this.curCatLv1),e.abrupt("break",20);case 16:return c.push(this.curCatLv1),c.push(this.curCatLv2),e.abrupt("break",20);case 19:return e.abrupt("break",20);case 20:if(l=this["catsLv".concat(t)],l[r]=o,!this.curCatLv3){e.next=25;break}return e.next=25,this.$store.state.editor.runCommand("SAVE",{triggerType:"CATALOG"});case 25:if(!this.curCatLv3||n===this["curCatLv".concat(r)]){e.next=28;break}return e.next=28,this.$store.state.editor.runCommand("CLEAN");case 28:return e.next=30,k.rename({task:a,ancestorCatNames:c,oldName:n,newName:o,catOrderAfterRename:l},this.$message);case 30:e.t1=t,e.next=1===e.t1?33:2===e.t1?37:3===e.t1?41:45;break;case 33:return this.waitOpenCatLv1=o,this.waitOpenCatLv2="",this.waitOpenCatLv3="",e.abrupt("break",46);case 37:return this.waitOpenCatLv1=this.curCatLv1,this.waitOpenCatLv2=o,this.waitOpenCatLv3="",e.abrupt("break",46);case 41:return this.waitOpenCatLv1=this.curCatLv1,this.waitOpenCatLv2=this.curCatLv2,this.waitOpenCatLv3=o,e.abrupt("break",46);case 45:return e.abrupt("break",46);case 46:return e.next=48,this.getCatalog();case 48:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),catalogDragStart:function(e,t,n,r){switch(this.draggedCatLv=t,this.draggedCatName=n,this.draggedCatIndex=r,t){case 1:this.catalogDragEnterLv1=this.preventDefault,this.catalogDragEnterLv2=this.enableDefault,this.catalogDragEnterLv3=this.enableDefault,this.catalogDragOverLv1=this.catalogDragOver,this.catalogDragOverLv2=this.enableDefault,this.catalogDragOverLv3=this.enableDefault,this.catalogDropLv1=this.catalogDrop,this.catalogDropLv2=this.enableDefault,this.catalogDropLv3=this.enableDefault;break;case 2:this.catalogDragEnterLv1=this.preventDefault,this.catalogDragEnterLv2=this.preventDefault,this.catalogDragEnterLv3=this.enableDefault,this.catalogDragOverLv1=this.catalogDragOver,this.catalogDragOverLv2=this.catalogDragOver,this.catalogDragOverLv3=this.enableDefault,this.catalogDropLv1=this.catalogDrop,this.catalogDropLv2=this.catalogDrop,this.catalogDropLv3=this.enableDefault;break;case 3:this.catalogDragEnterLv1=this.enableDefault,this.catalogDragEnterLv2=this.preventDefault,this.catalogDragEnterLv3=this.preventDefault,this.catalogDragOverLv1=this.enableDefault,this.catalogDragOverLv2=this.catalogDragOver,this.catalogDragOverLv3=this.catalogDragOver,this.catalogDropLv1=this.enableDefault,this.catalogDropLv2=this.catalogDrop,this.catalogDropLv3=this.catalogDrop;break;default:break}this.catalogHalfHeight||(this.catalogHalfHeight=Math.floor(parseInt(window.getComputedStyle(e.currentTarget).height,10)/2))},catalogDragEnd:function(){var e=this;this.catalogDragEnterLv1=null,this.catalogDragEnterLv2=null,this.catalogDragEnterLv3=null,this.catalogDragOverLv1=null,this.catalogDragOverLv2=null,this.catalogDragOverLv3=null,this.catalogDropLv1=null,this.catalogDropLv2=null,this.catalogDropLv3=null,setTimeout(function(){e.draggedCatLv=null,e.draggedCatName=null,e.draggedCatIndex=null,e.droppedCatLv=null,e.droppedCatName=null,e.droppedCatIndex=null,e.dropHalf=null},0)},catalogDragOver:function(e,t,n,r){e.preventDefault(),this.droppedCatLv=t,this.droppedCatName=n,this.droppedCatIndex=r,t===this.draggedCatLv?e.offsetY<=this.catalogHalfHeight?this.dropHalf="TOP":this.dropHalf="BOTTOM":this.dropHalf=null},catalogDragLeave:function(){this.droppedCatLv=null,this.droppedCatName=null,this.droppedCatIndex=null,this.dropHalf=null},catalogDrop:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n,r,a){var i,o,s,c,l,u,h,d,f,g,v,m,p,C,b,L,w,y;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i=this.draggedCatLv,o=this.draggedCatName,s=this.draggedCatIndex,c=this.dropHalf,l=n,u=r,h=a,d=!0,f={task:"REORDER",catName:o,affectedCatalogs:[]},i!==l){e.next=29;break}if(!(u===o||"TOP"===c&&h-s===1||"BOTTOM"===c&&s-h===1)){e.next=11;break}d=!1,e.next=27;break;case 11:g=[],e.t0=i,e.next=2===e.t0?15:3===e.t0?17:20;break;case 15:return g.push(this.curCatLv1),e.abrupt("break",21);case 17:return g.push(this.curCatLv1),g.push(this.curCatLv2),e.abrupt("break",21);case 20:return e.abrupt("break",21);case 21:v=this["catsLv".concat(i)].slice(),m="TOP"===c?h:h+1,p=[].concat(v.slice(0,m),o,v.slice(m)),C=s<m?s:s+1,p=p.filter(function(e,t){return t!==C}),f.affectedCatalogs.push({ancestorCatNames:g,newCatOrder:p});case 27:e.next=66;break;case 29:if(!(1===l&&u===this.curCatLv1||2===l&&u===this.curCatLv2)){e.next=33;break}d=!1,e.next=66;break;case 33:b=[],e.t1=l,e.next=1===e.t1?37:2===e.t1?41:46;break;case 37:return b.push(u),L=Object.keys(this.catalog[u]),L.push(o),e.abrupt("break",47);case 41:return b.push(this.curCatLv1),b.push(u),L=Object.keys(this.catalog[this.curCatLv1][u]),L.push(o),e.abrupt("break",47);case 46:return e.abrupt("break",47);case 47:if(new Set(L).size===L.length){e.next=52;break}d=!1,this.$message({type:"warning",message:"目录名已存在: ".concat(o)}),e.next=66;break;case 52:f.affectedCatalogs.push({ancestorCatNames:b,newCatOrder:L}),w=[],e.t2=i,e.next=2===e.t2?57:3===e.t2?59:62;break;case 57:return w.push(this.curCatLv1),e.abrupt("break",63);case 59:return w.push(this.curCatLv1),w.push(this.curCatLv2),e.abrupt("break",63);case 62:return e.abrupt("break",63);case 63:y=this["catsLv".concat(i)].slice().filter(function(e){return e!==o}),f.affectedCatalogs.push({ancestorCatNames:w,newCatOrder:y}),f.affectedCatalogs.reverse();case 66:if(!this.curCatLv3){e.next=69;break}return e.next=69,this.$store.state.editor.runCommand("SAVE",{triggerType:"CATALOG"});case 69:if(!d){e.next=86;break}return e.next=72,k.reorder(f);case 72:e.t3=i,e.next=1===e.t3?75:2===e.t3?79:3===e.t3?81:83;break;case 75:return this.waitOpenCatLv1=this.curCatLv1,this.waitOpenCatLv2="",this.waitOpenCatLv3="",e.abrupt("break",84);case 79:return i===l?(this.waitOpenCatLv1=this.curCatLv1,this.waitOpenCatLv2=o,this.waitOpenCatLv3=""):(this.waitOpenCatLv1=u,this.waitOpenCatLv2=o,this.waitOpenCatLv3=""),e.abrupt("break",84);case 81:return i===l?(this.waitOpenCatLv1=this.curCatLv1,this.waitOpenCatLv2=this.curCatLv2,this.waitOpenCatLv3=o):(this.waitOpenCatLv1=this.curCatLv1,this.waitOpenCatLv2=u,this.waitOpenCatLv3=o),e.abrupt("break",84);case 83:return e.abrupt("break",84);case 84:return e.next=86,this.getCatalog();case 86:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),preventDefault:function(e){e.preventDefault()},enableDefault:function(){},_getNoteCount:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.catalog,t=0;for(var n in e)if(e[n])for(var r in e[n])e[n][r]&&(t+=Object.keys(e[n][r]).length);return t}},mounted:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.closeCatalogContextMenuOnClick(),this.$watch("$store.state.editor",function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return t.$store.state.editor.catalogPlugin={getNoteCount:t._getNoteCount},e.next=4,t.getCatalog();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),{immediate:!0});case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},U=$,K=(n("5fca"),Object(_["a"])(U,h,d,!1,null,"0c2c20af",null));K.options.__file="catalog.vue";var z=K.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"search"}},[n("div",{attrs:{id:"search-bar"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],ref:"search-bar",staticClass:"input-bar",attrs:{type:"text",maxlength:e.maxSearchTextLength},domProps:{value:e.searchText},on:{keydown:e.searchBarKeyDownHandler,input:function(t){t.target.composing||(e.searchText=t.target.value)}}}),n("button",{class:{active:e.isGlobal},attrs:{title:"golbal search"},on:{click:function(t){e.isGlobal=!e.isGlobal}}},[e._v("g")]),n("button",{class:{active:e.isSensitiveToCase},attrs:{title:"sensitive to English case"},on:{click:function(t){e.isSensitiveToCase=!e.isSensitiveToCase}}},[e._v("Aa")]),n("div",{staticClass:"clear",on:{click:function(t){e.clear(!0)}}},[e._v("×")])]),e._e(),n("div",{attrs:{id:"search-info"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.isSearchDone,expression:"isSearchDone"}]},[e.searchedItemsNum<e.maxSearchResLength?n("div",[e._v("共匹配到 "+e._s(e.searchedItemsNum)+" 条结果, 耗时"+e._s(e.timeConsumption/1e3)+"s")]):n("div",{staticClass:"warning"},[e._v("匹配项过多, 只显示前 "+e._s(e.maxSearchResLength)+" 条结果, 耗时"+e._s(e.timeConsumption/1e3)+"s")])]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isSearching,expression:"isSearching"}]},[e._v("搜索中...")]),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.isSearching&&!e.isSearchDone,expression:"!isSearching && !isSearchDone"}]},[e._v("按Enter键进行搜索, 点击×清空搜索~")])]),n("div",{ref:"search-results",attrs:{id:"search-results"}},e._l(e.searchResults,function(t){return n("div",{key:t.dir,staticClass:"note"},[t.items.length>0?n("div",{staticClass:"note-dir",attrs:{title:t.dir+" ("+t.items.length+")"},on:{click:function(n){e.closedSearchRes[t.dir]?e.$set(e.closedSearchRes,t.dir,!1):e.$set(e.closedSearchRes,t.dir,!0)},dblclick:function(n){e.closedSearchRes[t.dir]?e.searchResults.forEach(function(t){return e.$set(e.closedSearchRes,t.dir,!1)}):e.searchResults.forEach(function(t){return e.$set(e.closedSearchRes,t.dir,!0)})}}},[n("note-icon",{staticClass:"note-icon",attrs:{"icon-name":t.dir.split("/")[2]}}),e._v("\n        "+e._s(t.dir.slice(0,t.dir.length-1))+" ("+e._s(t.items.length)+")\n      ")],1):e._e(),e._l(t.items,function(r){return n("div",{directives:[{name:"show",rawName:"v-show",value:!e.closedSearchRes[t.dir],expression:"!closedSearchRes[note.dir] "}],key:r.noteDir+r.line+"/"+r.char,class:{item:!0,active:e.activeSearchItem===r},on:{click:function(t){e.clickSearchItemHandler(r)}}},[n("div",{staticClass:"line"},[e._v(e._s(r.noteDir.slice(0,r.noteDir.length-1))+" "+e._s(r.line))]),n("div",{staticClass:"preview",domProps:{innerHTML:e._s(r.preview)}})])})],2)}))])},V=[],W=(n("55dd"),n("386d"),n("28a5"),{searchedTextClass:"cm-searched-text",highlightLineClass:"cm-highlight-line"}),Z=W,J=y.server.serverUrl,q={get:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=null,e.next=3,b.a.get("".concat(J,"files"),{params:{path:t}}).then(function(e){if(200!==e.status)throw n&&n.error("loadFile(): Bad HTTP status: ".concat(e)),new Error("loadFile(): Bad HTTP status: ".concat(e));"string"!==typeof e.data&&(e.data=JSON.stringify(e.data)),r=e.data}).catch(function(e){throw n&&n.error("loadFile failed: ".concat(e,"\n path: ").concat(t)),new Error("loadFile failed: ".concat(e,"\n path: ").concat(t))});case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),update:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n,r){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b.a.put("".concat(J,"files/"),JSON.stringify(t),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){if(200!==e.status)throw n&&n.error("文件保存失败: Bad Http Status"),new Error("File.update(), Bad Http Status: ".concat(e));if(console.log("[file updated] ".concat(t.path)),r&&n){var a=t.path.split("/"),i=a[a.length-1];n.success("updated: ".concat(i))}}).catch(function(e){throw n&&n.error("文件保存失败: Update Failed".concat(e)),new Error("File.update(), Update Failed: ".concat(e,". 文件保存失败: 可能是文件体积超限, 或服务器出现了问题. 请先妥善复制保管好您的笔记"))});case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}(),searchAllFiles:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n,r,a,i,o,s){var c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return c=null,e.next=3,b.a.get("".concat(J,"search-all-files"),{params:{fromPath:t,searchPath:n,searchText:r,searchedTextClass:a,isRegExp:i,isSensitiveToCase:o}}).then(function(e){if(200!==e.status)throw s&&s.error("searchAllFiles(): Bad HTTP status: ".concat(e)),new Error("searchAllFiles(): Bad HTTP status: ".concat(e.data));c=e.data}).catch(function(e){throw s&&s.error("searchAllFiles failed: ".concat(e)),new Error("searchAllFiles failed: ".concat(e))});case 3:return e.abrupt("return",c);case 4:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,o,s){return e.apply(this,arguments)}}(),getAllFilesInfo:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=null,e.next=3,b.a.get("".concat(J,"get-all-files-info")).then(function(e){if(200!==e.status)throw t&&t.error("getAllFilesInfo(): Bad HTTP status: ".concat(e)),new Error("getAllFilesInfo(): Bad HTTP status: ".concat(e));n=e.data}).catch(function(e){throw t&&t.error("getAllFilesInfo failed: ".concat(e)),new Error("getAllFilesInfo failed: ".concat(e))});case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},Y=q,Q=!1,X={name:"outline",components:{NoteIcon:P},data:function(){return{editor:null,curFilePath:null,curFileDir:null,searchText:"",lastSearchText:"",replaceText:"",isGlobal:!1,isSensitiveToCase:!1,isSearchDone:!1,isSearching:!1,isRegExp:!1,updateDelay:1400,updateTimer:null,searchedItemsNum:0,maxSearchTextLength:30,maxSearchResLength:null,maxSearchResLengthOne:50,maxSearchResLengthAll:200,timeConsumption:null,closedSearchRes:{},searchResults:[],activeSearchItem:null,waitHighlightAndScrollNoteDir:null,searchedTextClass:Z.searchedTextClass,highlightLineClass:Z.highlightLineClass}},watch:{"$store.state.editor":{immediate:!0,handler:function(e){e&&(this.editor=e)}},"$store.state.curFilePath":{immediate:!0,handler:function(e){var t=this;if(e){this.curFilePath=e;var n=this.curFilePath.split("/");this.curFileDir="".concat(n[0],"/").concat(n[1],"/").concat(n[2],"/"),this.waitHighlightAndScrollNoteDir===this.curFileDir&&(Q&&console.log("need to highlight and scroll after change curFilePath: ",this.waitHighlightAndScrollNoteDir),this.waitHighlightAndScrollNoteDir=null,setTimeout(function(){t.highlight(),t.editor.scrollNoteToThisLine(t.activeSearchItem.line,t.highlightLineClass,"intelligently",!0)},500))}}}},computed:{isReplaceAllAvailable:function(){return!this.isGlobal&&this.searchedItemsNum>0&&this.searchedItemsNum<this.maxSearchResLength}},methods:{search:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t,n,r,a,i,o=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(Q&&console.log("begin search"),this.clear(),this.searchText){e.next=4;break}return e.abrupt("return");case 4:if(this.lastSearchText=this.searchText,n=new Date,this.isSearching=!0,this.editor.on("changes",this.changesHandler),!this.isGlobal){e.next=21;break}return e.next=11,this.editor.runCommand("SAVE",{triggerType:"BEFORE_GLOBAL_SEARCH"});case 11:return this.maxSearchResLength=this.maxSearchResLengthAll,e.next=14,this.searchAll();case 14:r=e.sent,t=r.res,this.searchedItemsNum=r.searchedItemsNum,Q&&console.log("search globally"),t.forEach(function(e){o.$set(o.closedSearchRes,e.dir,!0)}),e.next=26;break;case 21:this.maxSearchResLength=this.maxSearchResLengthOne,a=this.searchCurrent(this.searchText),t=a.res,this.searchedItemsNum=a.searchedItemsNum,Q&&console.log("search one");case 26:Q&&console.log("searched items number",this.searchedItemsNum),this.searchedItemsNum&&(t=this.sortSearchRes(t),this.searchResults=t,this.highlight()),this.isSearchDone=!0,this.isSearching=!1,this.$refs["search-results"]&&(this.$refs["search-results"].scrollTop=0),i=new Date-n,this.timeConsumption=i,Q&&console.log("search end, results: ",this.searchResults,"time consumption: ",i);case 34:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),changesHandler:function(e,t){var n=this;clearTimeout(this.updateTimer),this.updateTimer=setTimeout(function(){var e=new Date;if(n.isGlobal){var r=n.lastSearchText;if(n.searchText.includes("|")){var a=n.lastSearchText.split("|"),i=Object(f["a"])(a,2);r=i[1]}if("setValue"!==t[0].origin){if(n.searchedItemsNum>=n.maxSearchResLengthAll+50)return;for(var o=0;o<n.searchResults.length;o+=1)if(n.searchResults[o].dir===n.curFileDir){var s=n.searchCurrent(r);if(s&&s.res&&s.res[0]){if(n.searchedItemsNum=n.searchedItemsNum-n.searchResults[o].items.length+s.res[0].items.length,n.searchedItemsNum>n.maxSearchResLengthAll+50)break;n.$set(n.searchResults,o,s.res[0]),n.highlight()}break}}else if("setValue"===t[0].origin){for(var c=!0,l=0;l<n.searchResults.length;l+=1)if(n.searchResults[l].dir===n.curFileDir){c=!1;break}c&&n.clear()}else n.clear()}else if(!n.isGlobal)if("setValue"!==t[0].origin){var u=n.searchCurrent(n.lastSearchText);u&&u.res&&u.res[0]&&(n.searchedItemsNum=u.searchedItemsNum,n.searchResults=u.res,n.highlight(),Q&&console.log("changes event emitted(not global): update"))}else n.clear();var h=new Date-e;Q&&console.log("changes event emitted(is global): Partial update","time consumption: ",h),console.log("search changes: ",h)},this.updateDelay)},clear:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Q&&console.log("clear"),e&&(this.searchText=""),this.replaceText="",this.lastSearchText="",this.searchResults=[],this.closedSearchRes={},this.searchedItemsNum=0,this.maxSearchResLength=null,this.waitHighlightAndScrollNoteDir=null,this.editor.off("changes",this.changesHandler),this.unhighlight(),this.isSearchDone=!1},searchCurrent:function(e){var t=0,n=[{dir:this.curFileDir,items:[]}];if(!e)return{searchedItemsNum:t,res:n};var r=this.editor.cm.getDoc(),a=r.lineCount();this.isSensitiveToCase||(e=e.toLowerCase());e:for(var i=0;i<a;i+=1){var o=r.getLine(i),s=o;if(this.isSensitiveToCase||(o=o.toLowerCase()),!this.isRegExp){var c=-1,l=!0;do{if(t>=this.maxSearchResLength)break e;if(c=o.indexOf(e,l?0:c+e.length),l=!1,c>-1){var u=c-30<0?0:c-30,h=[o.slice(u,c),'<span class="'.concat(this.searchedTextClass,'">'),s.slice(c,c+e.length),"</span>",o.slice(c+e.length,c+e.length+30)].join("");n[0].items.push({noteDir:this.curFileDir,line:i,char:[c,c+e.length],preview:h}),t+=1}}while(c>-1)}}return{searchedItemsNum:t,res:n}},searchAll:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t,n,r,a,i,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t="",n=this.searchText,this.searchText.includes("|")&&(r=this.searchText.split("|"),r[0]&&r[1]&&(a=Object(f["a"])(r,1),t=a[0],i=Object(f["a"])(r,2),n=i[1])),e.next=5,Y.searchAllFiles("".concat(this.curFilePath.split("/").slice(0,3).join("/"),"/"),t,n,this.searchedTextClass,this.isRegExp,this.isSensitiveToCase,this.$message);case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),searchBarKeyDownHandler:function(e){13===e.keyCode&&(Q&&console.log("search: press enter"),this.search())},clickSearchItemHandler:function(e){this.activeSearchItem=e,this.curFileDir===e.noteDir?this.editor.scrollNoteToThisLine(e.line,this.highlightLineClass,"intelligently",!0):(this.waitHighlightAndScrollNoteDir=e.noteDir,this.$store.commit("updateGotoThisCatalog",e.noteDir.split("/").slice(0,3)))},sortSearchRes:function(e){function t(e,t){var n=e.preview.match(/^#+ /),r=t.preview.match(/^#+ /),a=n?7-n[0].length:0,i=r?7-r[0].length:0;return i-a}e.sort(function(e,t){return t.items.length-e.items.length});for(var n=0;n<e.length;n+=1)e[n].items.sort(t);return e},replace:function(){},replaceCurrent:function(){},replaceAll:function(){},highlight:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var a,i=this.searchResults[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(o.dir===this.curFileDir){e=o.items,Q&&console.log("highlight:",o.dir);break}}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}var s=this.editor.cm.getDoc(),c=0,l=!0,u=!1,h=void 0;try{for(var d,f=e[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var g=d.value;if(!(c<this.maxSearchResLengthOne))break;s.markText({line:g.line,ch:g.char[0]},{line:g.line,ch:g.char[1]},{className:this.searchedTextClass}),c+=1}}catch(e){u=!0,h=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw h}}},unhighlight:function(){var e=this.editor.cm.getDoc(),t=e.getAllMarks(),n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;s.className===this.searchedTextClass&&s.clear()}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}}},mounted:function(){Q&&console.log("mounted"),this.$refs["search-bar"].focus()},destroyed:function(){this.clear(),Q&&console.log("destroyed")}},ee=X,te=(n("17c5"),Object(_["a"])(ee,G,V,!1,null,"0d22c03c",null));te.options.__file="search.vue";var ne=te.exports,re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"outline"}},[e.displayHeaders?e._e():n("div",{attrs:{id:"outline-info"}},[e._v("没有发现标题~")]),e._l(e.displayHeaders,function(t){return n("div",{key:t.lineNum+"-"+t.lv+"-"+t.text,ref:"lineNum"+t.lineNum,refInFor:!0,class:{item:!0,header1:1===t.lv,header2:2===t.lv,header3:3===t.lv,header4:4===t.lv,header5:5===t.lv,header6:6===t.lv,active:t.lineNum===e.activeHeaderLineNum},on:{click:function(n){e.scrollNoteToThisLine(t.lineNum)}}},[e._v(e._s(t.text.replace(/^#+/,"")))])})],2)},ae=[],ie=!1,oe={name:"outline",data:function(){return{editor:null,allHeaders:null,displayHeaders:null,curCursorLineNum:null,updateDelay:500,updateTimer:null,isUpdatedAfterSwitch:!1,isContentChanged:!1,isForbidHeadersBarToScroll:!1,highlightLineClass:Z.highlightLineClass,activeHeaderLineNum:-1}},watch:{"$store.state.editor":{immediate:!0,handler:function(e){e&&(this.editor=e,ie&&console.log("get editor",this.editor),this.isUpdatedAfterSwitch||(ie&&console.log("update after switch"),this.updateAllHeaders(),this.isUpdatedAfterSwitch=!0),this.editor.on("changes",this.changesHandler))}},"$store.state.editor.curCursorLineNum":{immediate:!0,handler:function(e){if(this.curCursorLineNum=e,e&&!this.isContentChanged){var t=new Date;this.calDisplayHeaders(e),this.isForbidHeadersBarToScroll?this.isForbidHeadersBarToScroll=!1:this.focusActiveHeader(e),ie&&(console.log("cursor changed: ",e),console.log("update consumption(cursor): ",new Date-t))}}}},methods:{changesHandler:function(){var e=this;this.isContentChanged=!0,clearTimeout(this.updateTimer),this.updateTimer=setTimeout(function(){var t=new Date;e.updateAllHeaders(),e.calDisplayHeaders(e.curCursorLineNum),e.focusActiveHeader(e.curCursorLineNum),e.isContentChanged=!1;var n=new Date-t;ie&&console.log("update consumption: (changes event emitted)",n),n>50&&console.warn("It took too long to update todos(without delay, ms): ",n),console.log("outline: changes",n)},this.updateDelay)},updateAllHeaders:function(){this.allHeaders=this.editor.getHeadersHierarchy(),ie&&console.log("update all headers: ",this.allHeaders)},focusActiveHeader:function(){var e=this;setTimeout(function(){ie&&console.log("focus active header"),e.$refs["lineNum".concat(e.activeHeaderLineNum)]&&e.$refs["lineNum".concat(e.activeHeaderLineNum)][0]&&e.$refs["lineNum".concat(e.activeHeaderLineNum)][0].scrollIntoView({behavior:"auto",block:"center",inline:"center"})},0)},calDisplayHeaders:function(e){if(this.allHeaders&&0!==this.allHeaders.length){var t=null,n=[],r=!0,a=!1,i=void 0;try{for(var o,s=this.allHeaders[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;if(c.lineNum<=e&&(t=c,n[0]=c),0!==c.children.length){var l=!0,u=!1,h=void 0;try{for(var d,f=c.children[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var g=d.value;if(g.lineNum<=e&&(t=g,n[1]=g),0!==g.children.length){var v=!0,m=!1,p=void 0;try{for(var C,b=g.children[Symbol.iterator]();!(v=(C=b.next()).done);v=!0){var L=C.value;if(L.lineNum<=e&&(t=L,n[2]=L),0!==L.children.length){var w=!0,y=!1,x=void 0;try{for(var S,k=L.children[Symbol.iterator]();!(w=(S=k.next()).done);w=!0){var D=S.value;if(D.lineNum<=e&&(t=D,n[3]=D),0!==D.children.length){var O=!0,N=!1,T=void 0;try{for(var _,I=D.children[Symbol.iterator]();!(O=(_=I.next()).done);O=!0){var R=_.value;if(R.lineNum<=e&&(t=R,n[4]=R),0!==R.children.length){var H=!0,F=!1,j=void 0;try{for(var A,E=R.children[Symbol.iterator]();!(H=(A=E.next()).done);H=!0){var P=A.value;P.lineNum<=e&&(t=P,n[5]=P)}}catch(e){F=!0,j=e}finally{try{H||null==E.return||E.return()}finally{if(F)throw j}}}}}catch(e){N=!0,T=e}finally{try{O||null==I.return||I.return()}finally{if(N)throw T}}}}}catch(e){y=!0,x=e}finally{try{w||null==k.return||k.return()}finally{if(y)throw x}}}}}catch(e){m=!0,p=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw p}}}}}catch(e){u=!0,h=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw h}}}}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}if(t){n=n.slice(0,t.lv);var B=[],M=!0,$=!1,U=void 0;try{for(var K,z=this.allHeaders[Symbol.iterator]();!(M=(K=z.next()).done);M=!0){var G=K.value;if(B.push(G),0!==G.children.length){var V=!0,W=!1,Z=void 0;try{for(var J,q=G.children[Symbol.iterator]();!(V=(J=q.next()).done);V=!0){var Y=J.value;if(B.push(Y),0!==Y.children.length){var Q=!0,X=!1,ee=void 0;try{for(var te,ne=Y.children[Symbol.iterator]();!(Q=(te=ne.next()).done);Q=!0){var re=te.value;if(t.lv>=2&&n[0]===G&&n[1]===Y&&B.push(re),0!==re.children.length){var ae=!0,ie=!1,oe=void 0;try{for(var se,ce=re.children[Symbol.iterator]();!(ae=(se=ce.next()).done);ae=!0){var le=se.value;if(t.lv>=3&&n[0]===G&&n[1]===Y&&n[2]===re&&B.push(le),0!==le.children.length){var ue=!0,he=!1,de=void 0;try{for(var fe,ge=le.children[Symbol.iterator]();!(ue=(fe=ge.next()).done);ue=!0){var ve=fe.value;if(t.lv>=4&&n[0]===G&&n[1]===Y&&n[2]===re&&n[3]===le&&B.push(ve),0!==ve.children.length){var me=!0,pe=!1,Ce=void 0;try{for(var be,Le=ve.children[Symbol.iterator]();!(me=(be=Le.next()).done);me=!0){var we=be.value;t.lv>=5&&n[0]===G&&n[1]===Y&&n[2]===re&&n[3]===le&&n[4]===ve&&B.push(we)}}catch(e){pe=!0,Ce=e}finally{try{me||null==Le.return||Le.return()}finally{if(pe)throw Ce}}}}}catch(e){he=!0,de=e}finally{try{ue||null==ge.return||ge.return()}finally{if(he)throw de}}}}}catch(e){ie=!0,oe=e}finally{try{ae||null==ce.return||ce.return()}finally{if(ie)throw oe}}}}}catch(e){X=!0,ee=e}finally{try{Q||null==ne.return||ne.return()}finally{if(X)throw ee}}}}}catch(e){W=!0,Z=e}finally{try{V||null==q.return||q.return()}finally{if(W)throw Z}}}}}catch(e){$=!0,U=e}finally{try{M||null==z.return||z.return()}finally{if($)throw U}}this.displayHeaders=B,this.activeHeaderLineNum=t.lineNum}else this.displayHeaders=[]}else this.displayHeaders=[]},scrollNoteToThisLine:function(e){this.isForbidHeadersBarToScroll=!0,this.calDisplayHeaders(e),this.editor.scrollNoteToThisLine(e,this.highlightLineClass,"unfoldAll",!0)}},created:function(){ie&&console.log("created")},destroyed:function(){this.editor.off("changes",this.changesHandler),ie&&console.log("destroyed")}},se=oe,ce=(n("a85f"),Object(_["a"])(se,re,ae,!1,null,"9725eec8",null));ce.options.__file="outline.vue";var le=ce.exports,ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"todo"}},[n("div",{attrs:{id:"todo-info"}},[e.todos.length<e.maxTodoNum?n("div",{staticClass:"normal"},[e._v("共有 "+e._s(e.todos.length)+" 条待办事项~")]):n("div",{staticClass:"warning"},[e._v("待办事项太多了, 只显示前 "+e._s(e.maxTodoNum)+" 条")])]),n("div",{attrs:{id:"todo-results"}},e._l(e.todos,function(t){return n("div",{key:t.lineNum+t.text,class:{item:!0,active:e.activeTodoItem===t},on:{click:function(n){e.clickTodoItemHandler(t)}}},[e._l(t.headers,function(t){return n("div",{key:t.headerLineNum+t.headerLineText,staticClass:"header"},[e._v(e._s(t.headerLineText.replace(/^#+/,"")))])}),n("div",{staticClass:"text"},[e._v(e._s(t.text.replace(e.todoMark,"")))])],2)}))])},he=[],de=!1,fe={name:"todo",data:function(){return{editor:null,todos:[],todoMark:"Todo: ",maxTodoNum:40,highlightLineClass:Z.highlightLineClass,todoStrLength:140,updateTimer:null,activeTodoItem:null,isUpdatedAfterSwitch:!1,updateDelay:600}},watch:{"$store.state.editor":{immediate:!0,handler:function(e){var t=this;e&&(de&&console.log("watch: editor",e),this.editor=e,setTimeout(function(){t.isUpdatedAfterSwitch||(t.updateTodos(),t.isUpdatedAfterSwitch=!0),t.editor.on("changes",t.changesHandler)},0))}}},methods:{updateTodos:function(){for(var e=[],t=this.editor.cm.getDoc(),n=t.lineCount(),r=0;r<n;r+=1){if(e.length>=this.maxTodoNum)break;var a=t.getLine(r);this.isThisATodo(a)&&e.push({lineNum:r,text:"".concat(a.slice(0,this.todoStrLength)).concat(a.length>this.todoStrLength?"...":""),headers:this.editor.getHeaderAncestors({line:r,ch:0}).reverse()})}this.todos=e,de&&console.log("updated todos: ",this.todos)},changesHandler:function(){var e=this;clearTimeout(this.updateTimer),this.updateTimer=setTimeout(function(){var t=new Date;de&&console.log("changes event emmited: need to update todos"),e.updateTodos();var n=new Date-t;n>50&&console.warn("It took too long to update todos: ",n),de&&console.log("cumulative update consumption: ",n),console.log("todo: changes: ",n)},this.updateDelay)},clickTodoItemHandler:function(e){var t=this;this.activeTodoItem=e,setTimeout(function(){t.editor.scrollNoteToThisLine(e.lineNum,t.highlightLineClass,"intelligently",!0)},0)},isThisATodo:function(e){return 0===e.indexOf(this.todoMark)}},created:function(){de&&console.log("created")},destroyed:function(){this.editor.off("changes",this.changesHandler),de&&console.log("destroyed")}},ge=fe,ve=(n("15d0"),Object(_["a"])(ge,ue,he,!1,null,"582d733d",null));ve.options.__file="todo.vue";var me=ve.exports,pe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("textarea",{ref:"sticky-note",attrs:{id:"sticky-note",contenteditable:"true",maxlength:e.maxlength,placeholder:"Can only enter up to 1000 words"},on:{keydown:e.setNoteContent}})},Ce=[],be=!0,Le={name:"sticky-note",data:function(){return{maxlength:1e3,setNoteTimer:null,setNoteInterval:2e3,localStorageKey:"stickyNoteContent"}},methods:{getNoteContent:function(){this.$refs["sticky-note"].value=localStorage.getItem(this.localStorageKey)},setNoteContent:function(e){var t=this;e.ctrlKey&&83===e.keyCode?e.preventDefault():(clearTimeout(this.setNoteTimer),this.setNoteTimer=setTimeout(function(){localStorage.setItem(t.localStorageKey,t.$refs["sticky-note"].value)},this.setNoteInterval))}},mounted:function(){be&&console.log("sticky note mounted"),this.getNoteContent(),this.$refs["sticky-note"].focus()},beforeDestroy:function(){clearTimeout(this.setNoteTimer),localStorage.setItem(this.localStorageKey,this.$refs["sticky-note"].value),be&&console.log("sticky note destroy")}},we=Le,ye=(n("a19a"),Object(_["a"])(we,pe,Ce,!1,null,"7dfa1af9",null));ye.options.__file="sticky-note.vue";var xe=ye.exports,Se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"search-note-bar",attrs:{id:"search-note-bar"}},[n("div",{staticClass:"wrapper"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],ref:"search-input",staticClass:"search-input",attrs:{type:"text",onfocus:"this.select();"},domProps:{value:e.searchText},on:{input:function(t){t.target.composing||(e.searchText=t.target.value)}}}),n("div",{staticClass:"placeholder"}),n("div",{directives:[{name:"show",rawName:"v-show",value:e.maxSearchResLengthWarn,expression:"maxSearchResLengthWarn"}],staticClass:"max-search-res-length-warn"},[e._v(e._s(e.maxSearchResLengthWarn))]),n("ul",{staticClass:"search-res"},e._l(e.searchRes,function(t){return n("li",{key:t.toString(),ref:t===e.searchRes[0+e.curSelectedSearchResBias]?"selected-search-res":"",refInFor:!0,class:{"selected-search-res":t===e.searchRes[0+e.curSelectedSearchResBias]},attrs:{title:t},on:{click:function(n){e.gotoNote(t)}}},[n("note-icon",{staticClass:"note-icon",attrs:{"icon-name":t.split("/")[2]}}),e._v("\n        "+e._s(t)+"\n      ")],1)}))])])},ke=[],De=!1,Oe={name:"search-note-bar",components:{NoteIcon:P},data:function(){return{catalogArr:[],searchText:"",searchRes:[],searchTimeoutId:null,searchDealy:240,maxSearchResLength:30,maxSearchResLengthWarn:"",curSelectedSearchResBias:0,staticIconUrl:y.server.staticIconUrl,defaultIconUrl:"".concat(y.server.staticIconUrl).concat(y.defaultIconName)}},watch:{searchText:function(e){this.search(e)}},methods:{open:function(){var e=this,t=p.a.cloneDeep(this.$store.state.catalog);for(var n in t)for(var r in t[n])for(var a in t[n][r])this.catalogArr.push("".concat(n,"/").concat(r,"/").concat(a));this.$store.state.curFilePath&&(this.searchText=this.$store.state.curFilePath.split("/").slice(0,2).join("/"),this.searchText+="/"),setTimeout(function(){e.$refs["search-input"]&&e.$refs["search-input"].focus()},100)},close:function(){this.catalogArr=[],this.searchText="",this.searchRes=[],this.curSelectedSearchResBias=0,this.maxSearchResLengthWarn=""},search:function(e){var t=this;clearTimeout(this.searchTimeoutId),this.searchTimeoutId=setTimeout(function(){var n=0;t.maxSearchResLengthWarn="",t.searchRes=[];var r=[];if(e){if(e){var a=!0,i=!1,o=void 0;try{for(var s,c=t.catalogArr[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var l=s.value;if(l.toLowerCase().includes(e.toLowerCase())&&(n+=1,r.push(l),n>=t.maxSearchResLength)){t.maxSearchResLengthWarn="Only the top ".concat(t.maxSearchResLength," results are displayed");break}}}catch(e){i=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}}t.searchRes=r}},this.searchDealy)},gotoNote:function(e){this.close(),this.$emit("close"),e&&this.$store.commit("updateGotoThisCatalog",e.split("/"))},imgLoadError:function(e){e.target.src=this.defaultIconUrl},bindHotKey:function(e){var t=this;e.addEventListener("keydown",function(e){40!==e.keyCode&&38!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),40===e.keyCode&&t.curSelectedSearchResBias<t.searchRes.length-1&&(t.curSelectedSearchResBias+=1),38===e.keyCode&&t.curSelectedSearchResBias>0&&(t.curSelectedSearchResBias-=1),t.$refs["selected-search-res"][0]&&t.$refs["selected-search-res"][0].scrollIntoView({block:"center"}),13===e.keyCode&&t.gotoNote(t.searchRes[0+t.curSelectedSearchResBias]))})}},mounted:function(){De&&console.log("search note bar mounted"),this.bindHotKey(this.$refs["search-note-bar"]),this.open()},destroyed:function(){this.close(),De&&console.log("search note bar destroyed")}},Ne=Oe,Te=(n("5e15"),Object(_["a"])(Ne,Se,ke,!1,null,"37de98bf",null));Te.options.__file="search-note-bar.vue";var _e=Te.exports,Ie=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"statistics"}},[n("div",{attrs:{id:"top-bar"}},[n("div",{staticClass:"buttons"},[n("button",{staticClass:"get-statistics",attrs:{disabled:e.isGettingStatistics},on:{click:e.getStatistics}},[e._v("获取")]),n("button",{staticClass:"sort",attrs:{disabled:!e.isGetStatisticsDone},on:{click:e.sort}},[e._v(e._s(e.isSorted?"取消排序":" 排序"))])]),n("div",{staticClass:"tips"},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.noteCount>=e.tooManyNoteCount&&!e.isGettingStatistics&&!e.isGetStatisticsDone,expression:"noteCount >= tooManyNoteCount && !isGettingStatistics && !isGetStatisticsDone"}],staticClass:"tip warning"},[e._v("共有 "+e._s(e.noteCount)+" 篇笔记"+e._s(e.noteCount>=e.tooManyNoteCount?", 统计可能需要较长时间":""))]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isGettingStatistics&&!e.isGetStatisticsDone,expression:"isGettingStatistics && !isGetStatisticsDone"}],staticClass:"tip processing"},[e._v("统计中...")]),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.isGettingStatistics&&e.isGetStatisticsDone,expression:"!isGettingStatistics && isGetStatisticsDone"}],staticClass:"tip result-info"},[e._v("统计结束, 耗时: "+e._s(e.timeConsumption/1e3)+"s")])])]),n("div",{attrs:{id:"result"}},e._l(e.displayFileInfo,function(t,r){return n("div",{key:r,class:{item:!0,lv1:1===t.lv,lv2:2===t.lv,lv3:3===t.lv},attrs:{title:r},on:{click:function(t){e.updateDisplayFilesInfo(r)}}},[n("div",{staticClass:"note-path"},[n("note-icon",{staticClass:"note-icon",attrs:{"icon-name":r.split("/")[r.split("/").length-1]}}),e._v("\n        "+e._s(r)+"\n      ")],1),n("div",{staticClass:"info-line"},[n("div",{staticClass:"info proportion"},[e._v("占比: "+e._s(e.calProportion(r))+" "+e._s(e.calProportion(r,!0)))]),n("div",{staticClass:"info word-count"},[e._v("字数: "+e._s(e.calWordCount(t.wordCount)))])])])}))])},Re=[],He=!1,Fe={name:"statistics",components:{NoteIcon:P},data:function(){return{editor:null,catalog:null,allFilesInfoProcessed:null,displayFileInfo:{},isGettingStatistics:!1,isGetStatisticsDone:!1,noteCount:null,tooManyNoteCount:500,timeConsumption:0,lastSelectedPath:"",isSorted:!1}},watch:{"$store.state.editor":{immediate:!0,handler:function(e){e&&(this.editor=e,this.editor&&this.editor.catalogPlugin&&(this.noteCount=this.editor.catalogPlugin.getNoteCount()))}},"$store.state.catalog":{immediate:!0,deep:!0,handler:function(e){e&&(this.catalog=e)}}},methods:{getStatistics:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.clear(),t=new Date,e.next=4,Y.getAllFilesInfo();case 4:n=e.sent,n=this.calAllFilesInfoProcessed(n),this.allFilesInfoProcessed=this.sortByCatalog(n),this.updateDisplayFilesInfo("/"),this.timeConsumption=new Date-t,this.isGettingStatistics=!1,this.isGetStatisticsDone=!0;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),clear:function(){this.isSorted=!1,this.isGettingStatistics=!0,this.isGetStatisticsDone=!1,this.displayFileInfo={}},sort:function(){this.isSorted?this.allFilesInfoProcessed=this.sortByCatalog(this.allFilesInfoProcessed):this.allFilesInfoProcessed=this.sortByWordCount(this.allFilesInfoProcessed),this.updateDisplayFilesInfo("/"),this.isSorted=!this.isSorted},calAllFilesInfoProcessed:function(e){var t={},n=Object.keys(e);t["/"]={lv:0,childrenNum:n.length};var r=0;return n.forEach(function(n){var a=Object.keys(e[n]);t[n]={lv:1,childrenNum:a.length};var i=0;a.forEach(function(r){var a=Object.keys(e[n][r]);t["".concat(n,"/").concat(r)]={lv:2,childrenNum:a.length};var o=0;a.forEach(function(){var a=Object(g["a"])(regeneratorRuntime.mark(function a(i){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:t["".concat(n,"/").concat(r,"/").concat(i)]={lv:3,childrenNum:0,wordCount:e[n][r][i].wordCount},o+=e[n][r][i].wordCount;case 2:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}()),t["".concat(n,"/").concat(r)].wordCount=o,i+=o}),t[n].wordCount=i,r+=i}),t["/"].wordCount=r,t},sortByCatalog:function(e){var t=this;if(!this.catalog)return e;var n={"/":e["/"]};return Object.keys(this.catalog).forEach(function(r){n[r]=e[r],Object.keys(t.catalog[r]).forEach(function(a){n["".concat(r,"/").concat(a)]=e["".concat(r,"/").concat(a)],Object.keys(t.catalog[r][a]).forEach(function(t){n["".concat(r,"/").concat(a,"/").concat(t)]=e["".concat(r,"/").concat(a,"/").concat(t)]})})}),n},sortByWordCount:function(e){var t={},n=Object.keys(e);n.sort(function(t,n){return e[n].wordCount-e[t].wordCount}),n.forEach(function(n){t[n]=e[n]});var r={"/":{}};Object.keys(t).forEach(function(e){if("/"!==e){var t=e.split("/");1===t.length?r["/"][t[0]]={}:2===t.length?r["/"][t[0]][t[1]]={}:3===t.length&&(r["/"][t[0]][t[1]][t[2]]={})}});var a={};return Object.keys(r).forEach(function(e){a[e]=t[e],Object.keys(r[e]).forEach(function(n){a[n]=t[n],Object.keys(r[e][n]).forEach(function(i){a["".concat(n,"/").concat(i)]=t["".concat(n,"/").concat(i)],Object.keys(r[e][n][i]).forEach(function(e){a["".concat(n,"/").concat(i,"/").concat(e)]=t["".concat(n,"/").concat(i,"/").concat(e)]})})})}),a},updateDisplayFilesInfo:function(e){var t=this;if(this.allFilesInfoProcessed&&e)if(3===this.allFilesInfoProcessed[e].lv)this.$store.commit("updateGotoThisCatalog",e.split("/").slice(0,3));else{var n={};if("/"===e){for(var r in this.allFilesInfoProcessed)this.allFilesInfoProcessed[r].lv<=1&&(n[r]=this.allFilesInfoProcessed[r]);this.lastSelectedPath=e}else if(e===this.lastSelectedPath||this.lastSelectedPath.includes("".concat(e,"/")))Object.keys(this.displayFileInfo).forEach(function(r){r.includes("".concat(e,"/"))||(n[r]=t.displayFileInfo[r])}),this.lastSelectedPath="";else if(e!==this.lastSelectedPath){var a=e.split("/");for(var i in this.allFilesInfoProcessed)this.allFilesInfoProcessed[i].lv<=1?n[i]=this.allFilesInfoProcessed[i]:i.includes("".concat(e,"/"))&&this.allFilesInfoProcessed[i].lv===this.allFilesInfoProcessed[e].lv+1?n[i]=this.allFilesInfoProcessed[i]:i===e?n[i]=this.allFilesInfoProcessed[i]:2===a.length&&(i===a[0]||i.includes("".concat(a[0],"/"))&&2===this.allFilesInfoProcessed[i].lv)&&(n[i]=this.allFilesInfoProcessed[i]);this.lastSelectedPath=e}this.displayFileInfo=n}else;},calProportion:function(e,t){var n="",r=0,a=this.allFilesInfoProcessed["/"].wordCount;if("/"===e)r=a;else{var i=e.split("/");1===i.length?r=this.allFilesInfoProcessed["/"].wordCount:2===i.length?r=this.allFilesInfoProcessed[i[0]].wordCount:3===i.length&&(r=this.allFilesInfoProcessed["".concat(i[0],"/").concat(i[1])].wordCount)}return 0===r&&(r=1),t&&(r=a),n=(this.allFilesInfoProcessed[e].wordCount/r*100).toFixed(2),n+="%",n},calWordCount:function(e){var t=0;return t=e<1e3?e:"".concat((e/1e4).toFixed(2),"万"),t}},created:function(){He&&console.log("created")},destroyed:function(){He&&console.log("destroyed")}},je=Fe,Ae=(n("1390"),Object(_["a"])(je,Ie,Re,!1,null,"1b21c733",null));Ae.options.__file="statistics.vue";var Ee=Ae.exports,Pe={icon:'<path stroke="null" transform="rotate(22.609697341918945 560.8153076171869,512.9096679687502) " d="m574.40574,999.05181l-4.87199,0a502.30187,502.30187 0 0 1 -357.60386,-153.4676a509.60986,509.60986 0 0 1 -12.66716,-682.07821a493.5323,493.5323 0 0 1 194.87948,-133.49244a48.71988,48.71988 0 0 1 51.64307,10.71836a48.71988,48.71988 0 0 1 11.69277,48.71988a409.24692,409.24692 0 0 0 94.51655,429.22207a412.65732,412.65732 0 0 0 430.19647,94.51656a48.71988,48.71988 0 0 1 61.87424,62.84863a494.99389,494.99389 0 0 1 -114.0045,176.85313a500.84028,500.84028 0 0 1 -355.65507,146.15962z" id="svg_1"/>',handler:function(e){var t=!1,n=e.cm;return n.isReadOnly()?(n.setOption("readOnly",!1),t=!1,e.messager.warning("退出只读模式")):(n.setOption("readOnly","nocursor"),t=!0,e.messager.warning("进入只读模式")),t}},Be='<path stroke="null" id="svg_1" d="m875.92527,9.32939l-308.77612,0l-85.54014,0l-143.75495,0l-85.54013,0l-110.60815,0c-47.28468,0 -85.54014,36.2461 -85.54014,81.04717l0,847.7309c0,44.80108 38.25545,81.04718 85.54014,81.04718l734.33833,0c47.28468,0 85.54014,-36.2461 85.54014,-81.04718l0,-847.7309c-0.11881,-44.80107 -38.49307,-81.04717 -85.65895,-81.04717l0,0l-0.00002,0l-0.00002,0zm-394.31627,81.04717l0,236.27502l-10.3361,-9.7932l-39.56232,-37.48432c-11.28653,-10.69373 -29.70143,-10.8063 -41.10679,-0.11257l-52.74975,49.41626l0,-238.3012l143.75495,0l0,0l0.00001,0zm-339.90324,847.7309l0,-63.93722l734.21951,0l0,63.93722l-734.21951,0l0,0z"/>\n<rect id="svg_2" height="262.50842" width="241.67441" y="51.64716" x="300.53472" fill-opacity="null" stroke-opacity="null" stroke-width="null" stroke="null" fill="null"/>\n<path id="svg_8" fill="#eee" d="m700.23348,322.00314c-2.08721,-6.37501 -7.65308,-11.05001 -14.34283,-12.00626l-110.03302,-15.88439l-49.23657,-98.97192c-2.99701,-6.00312 -9.15158,-9.82814 -15.89485,-9.82814c-6.74326,0 -12.89784,3.825 -15.89485,9.82814l-49.23657,98.97192l-110.03302,15.88439c-6.68975,0.95625 -12.25562,5.57812 -14.34283,12.00626c-2.0872,6.375 -0.3211,13.3875 4.49552,18.06251l79.6348,77.03128l-18.7313,108.80004c-1.12388,6.58751 1.60554,13.28125 7.06438,17.21251c5.45884,3.93125 12.68377,4.4625 18.67778,1.32812l98.41961,-51.3719l98.41961,51.3719c2.56887,1.32812 5.40533,2.01876 8.24177,2.01876c3.69275,0 7.33196,-1.11563 10.43601,-3.34688c5.45884,-3.93125 8.18825,-10.62501 7.06437,-17.21251l-18.78481,-108.80004l79.63479,-77.03128c4.76311,-4.675 6.52919,-11.68751 4.442,-18.06251l0,0l-0.00001,0l0.00002,0z" stroke="null"/>',Me='<path stroke="null" id="svg_1" d="m666.90762,734.17833l0,259.03089l-565.3552,0c-16.25323,0 -30.16786,-5.73765 -41.39313,-17.33248c-11.34218,-11.59483 -16.95481,-25.81941 -16.95481,-42.31516l0,-836.97936c0,-16.61527 5.61263,-30.83985 16.95481,-42.31516c11.34218,-11.59483 25.25682,-17.33248 41.39313,-17.33248l818.62498,0c16.25323,0 30.16786,5.73765 41.39313,17.33248c11.34218,11.59483 16.95481,25.81941 16.95481,42.31516l0,577.82894l-253.15285,0c-16.25323,0 -30.16786,5.73765 -41.39313,17.33248c-11.34218,11.71437 -17.07174,25.81941 -17.07174,42.43468l-0.00001,0l0,0.00001zm77.99213,19.8427l232.1055,0c-6.08034,33.94775 -19.41034,61.32111 -39.63918,82.23962l-112.01868,114.51389c-20.34577,20.67944 -47.12268,34.30635 -80.44765,40.52214l0,-237.27564l0.00001,-0.00001z"/>',$e='<path stroke="null" transform="rotate(90.2223892211914 511.9998779296875,511.9998779296875) " id="svg_1" d="m995.859,859.804l-207.208,-207.211c40.979,-65.521 64.691,-142.948 64.691,-225.925c0.002,-235.643 -191.022,-426.667 -426.664,-426.668c-235.641,0 -426.666,191.026 -426.666,426.666c0,235.642 191.025,426.668 426.666,426.668c82.988,0 160.426,-23.719 225.951,-64.71l207.246,207.247c37.505,37.505 98.473,37.505 135.984,0c37.505,-37.595 37.505,-98.48 0,-136.067zm-569.18,-177.137c-141.387,0 -256,-114.615 -256,-256.001c0,-141.385 114.614,-256 256,-255.998c141.386,0 256,114.614 256,256c-0.001,141.384 -114.617,255.999 -256,255.999z"/>',Ue='<path stroke="null" id="svg_1" d="m898.73989,820.52141a129.5098,129.5098 0 0 0 108.64915,124.49383l0,2.55324l-853.04078,0c-78.93361,0 -142.90986,-56.87783 -142.90986,-127.02897s63.97624,-127.02898 142.90986,-127.02898l853.04078,0l0,2.53515a129.5098,129.5098 0 0 0 -108.64915,124.47572zm-887.30148,-307.54956c0,-70.15115 63.97624,-127.02898 142.90986,-127.02898l853.04078,0l0,2.26352a125.96059,125.96059 0 0 0 0,249.53091l0,2.28163l-853.04078,0c-78.93361,-0.01811 -142.90986,-56.89594 -142.90986,-127.04709zm0,-307.56767c0,-70.15113 63.97624,-127.02897 142.90986,-127.02897l853.04078,0l0,2.55324a129.5098,129.5098 0 0 0 -108.64915,124.49383a129.5098,129.5098 0 0 0 108.64915,124.49383l0,2.53515l-853.04078,0c-78.93361,0 -142.90986,-56.87783 -142.90986,-127.04709z"/>',Ke='<path d="M892.171846 162.702776H742.636922c-0.698295-46.486508-39.503556-84.294204-87.685923-85.291768-4.688553-43.394057-42.695762-77.411008-88.883001-77.411008H456.834681c-46.187238 0-84.194447 33.917194-88.883001 77.411008-47.982854 0.897808-86.987628 38.605748-87.685923 85.291768H130.830589c-48.481637 0-87.685923 37.907453-87.685923 84.792986v689.317097c0 46.885533 39.204286 84.792986 87.685923 84.792986H892.07209c48.481637 0 87.685923-37.907453 87.685923-84.792986v-689.317097c0-46.785777-39.204286-84.792986-87.586167-84.792986z m-550.057087 0c0.798052-14.06566 12.768826-25.338139 27.532781-25.338139h28.729859c17.058354 0 30.924501-13.367365 30.924501-29.926936V86.688358c0-14.763955 12.3698-26.634973 27.532781-26.634973h109.233317c15.162981 0 27.532781 11.970774 27.532781 26.634973v20.849099c0 16.559571 13.866147 29.926936 30.924501 29.926937h28.729859c14.763955 0 26.73473 11.272479 27.532781 25.338139V222.955675c0 14.664199-12.3698 26.634973-27.532781 26.634973H369.64754c-15.162981 0-27.532781-11.970774-27.532781-26.634973v-60.252899z m445.013541 338.274136l-318.223088 307.948173c-7.980516 7.781003-18.654457 11.671505-29.128885 11.671505s-21.148368-3.890502-29.128884-11.671505L235.874135 639.837896c-16.160546-15.562007-16.160546-40.900146 0-56.462153 16.060789-15.562007 42.19698-15.562007 58.25777 0l145.544666 140.756356L728.870531 444.415002c16.160546-15.562007 42.19698-15.562007 58.257769 0.099757 16.160546 15.661763 16.160546 40.999903 0 56.462153z" p-id="7845"></path>',ze='<path d="M929.476923 984.615385h-133.907692c-31.507692 0-55.138462-27.569231-55.138462-59.076923v-512c0-31.507692 23.630769-59.076923 55.138462-59.076924h133.907692c31.507692 0 55.138462 27.569231 55.138462 59.076924v512c0 31.507692-23.630769 59.076923-55.138462 59.076923z m-350.523077 0h-137.846154c-31.507692 0-55.138462-27.569231-55.138461-59.076923v-827.076924c0-31.507692 23.630769-59.076923 55.138461-59.076923h137.846154c31.507692 0 55.138462 27.569231 55.138462 59.076923v823.138462c0 35.446154-23.630769 63.015385-55.138462 63.015385z m-350.523077 0H94.523077c-31.507692 0-55.138462-27.569231-55.138462-59.076923v-287.507693c0-31.507692 23.630769-59.076923 55.138462-59.076923h133.907692c31.507692 0 55.138462 27.569231 55.138462 59.076923v287.507693c0 31.507692-23.630769 59.076923-55.138462 59.076923z" p-id="2305"></path>',Ge=!1,Ve={name:"side-bar",components:{Catalog:z,Search:ne,Outline:le,Todo:me,StickyNote:xe,SearchNoteBar:_e,Statistics:Ee},data:function(){var e=this;return{editor:null,activePage:"Catalog",activeButtons:{},isSideBarSmallMode:!1,isShowStickyNote:!1,isShortcutKeyBinded:!1,isShowSearchNoteBar:!1,toggleToolPageShortcut:["Ctrl","Shift","B"],tools:[{name:"Catalog",icon:Be,type:"page",keyMap:["Ctrl","Shift","E"]},{name:"Read Only",icon:Pe.icon,type:"button",onclick:Pe.handler,lastStatus:!1},{name:"Sticky Note",icon:Me,type:"button",onclick:function(){return e.isShowStickyNote=!e.isShowStickyNote,e.isShowStickyNote},lastStatus:!1},{name:"Search Note Bar",icon:null,type:"button",onclick:function(){return e.isShowSearchNoteBar=!e.isShowSearchNoteBar,e.isShowSearchNoteBar},keyMap:["Ctrl","P"],onEsc:function(){e.isShowSearchNoteBar=!1},lastStatus:!1},{name:"Todo",icon:Ke,type:"page"},{name:"Outline",icon:Ue,type:"page",keyMap:["Ctrl","Shift","O"]},{name:"Search",icon:$e,type:"page",keyMap:["Ctrl","F"]},{name:"Statistics",icon:ze,type:"page"}]}},watch:{"$store.state.editor":{immediate:!0,handler:function(e){e&&(this.editor=e,Ge&&console.log("get editor"),this.isShortcutKeyBinded||(this.bindShortcuKey(),this.isShortcutKeyBinded=!0,Ge&&console.log("bind shortcut key")))}}},methods:{changeTool:function(e,t){Ge&&console.log("change tool: ",e),"page"===e.type?(t||e.name!==this.activePage?this.isSideBarSmallMode=!1:e.name===this.activePage&&(this.isSideBarSmallMode=!this.isSideBarSmallMode),this.activePage=e.name):"button"===e.type&&e.onclick&&(e.lastStatus=e.onclick(this.$store.state.editor,e.lastStatus),this.activeButtons[e.name]||this.$set(this.activeButtons,e.name,!0),e.lastStatus?this.activeButtons[e.name]=!0:this.activeButtons[e.name]=!1)},bindShortcuKey:function(){var e=this;this.editor.bindShortcutKeyMap(document,this.toggleToolPageShortcut,function(){e.isSideBarSmallMode=!e.isSideBarSmallMode});var t=!0,n=!1,r=void 0;try{for(var a,i=function(){var t=a.value;if(t.onEsc&&document.addEventListener("keydown",function(e){27===e.keyCode&&t.onEsc()}),!t.keyMap)return"continue";e.editor.bindShortcutKeyMap(document,t.keyMap,function(){return e.changeTool(t,!0)})},o=this.tools[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)i()}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}}},We=Ve,Ze=(n("4026"),Object(_["a"])(We,l,u,!1,null,"7cceb4b3",null));Ze.options.__file="sidebar.vue";var Je=Ze.exports,qe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"note-content"}},[n("quick-open-bar",{attrs:{id:"quick-open-bar"}}),n("editor",{attrs:{id:"editor"}})],1)},Ye=[],Qe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{attrs:{id:"quick-open-bar"}},e._l(e.allNoteDirs,function(t){return n("li",{directives:[{name:"show",rawName:"v-show",value:t,expression:"noteDir"}],key:t,class:{item:!0,active:t===e.curFileDir,fixed:e.fixedNoteDirs.includes(t)},attrs:{title:t.slice(0,t.length-1)},on:{mousedown:function(n){e.closeNoteByMidBtn(n,t)},click:function(n){e.switchNote(n,t)},dblclick:function(n){e.fixThisNoteDir(t)}}},[n("note-icon",{staticClass:"note-icon",attrs:{"icon-name":t.split("/")[2]}}),e._v("\n    "+e._s(t.split("/")[2])+"\n    "),n("span",{staticClass:"whole-dir"},[e._v(e._s(e.calWholeDir(t)))]),n("div",{class:e.closeButtonClass,on:{click:function(n){e.closeNote(t)}}},[e._v("×")])],1)}))},Xe=[],et=n("8afe"),tt=!1,nt={name:"quick-open-bar",components:{NoteIcon:P},data:function(){return{editor:null,curFilePath:"",curFileDir:"",fixedNoteDirs:[],tempNoteDir:"",maxFixedNum:7,closeButtonClass:"close-button"}},watch:{"$store.state.editor":{immediate:!0,handler:function(e){e&&(this.editor=e)}},"$store.state.curFilePath":{immediate:!0,handler:function(e){if(e){tt&&console.log("curFilePath changed:",e),this.curFilePath=e;var t=this.curFilePath.split("/");this.curFileDir="".concat(t[0],"/").concat(t[1],"/").concat(t[2],"/"),this.fixedNoteDirs.includes(this.curFileDir)||(this.tempNoteDir=this.curFileDir)}}},"$store.state.catalog":{immediate:!0,deep:!0,handler:function(e){if(e){tt&&console.log("catalog changed:",e);for(var t=this.fixedNoteDirs.length,n=0;n<t;n+=1){var r=this.fixedNoteDirs[n],a=r.split("/").slice(0,3),i=!1;"object"===Object(v["a"])(e[a[0]])&&Object(v["a"])(e[a[0]][a[1]])&&"object"===Object(v["a"])(e[a[0]][a[1]][a[2]])&&(i=!0),i||(this.fixedNoteDirs.splice(n,1),t-=1,n-=1,tt&&console.log("remove tab from fixedNoteDirs: ",r))}if(this.tempNoteDir){var o=this.tempNoteDir.split("/").slice(0,3),s=!1;"object"===Object(v["a"])(e[o[0]])&&Object(v["a"])(e[o[0]][o[1]])&&"object"===Object(v["a"])(e[o[0]][o[1]][o[2]])&&(s=!0),s||(tt&&console.log("remove tab: tempNoteDir: ",this.tempNoteDir),this.tempNoteDir="")}}}}},computed:{allNoteDirs:function(){var e=this.fixedNoteDirs.slice();return!e.includes(this.tempNoteDir)&&this.tempNoteDir&&e.push(this.tempNoteDir),tt&&console.log("trigger recalculate allNoteDirs: ",e),e}},methods:{switchNote:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n===this.curFileDir||Object(et["a"])(t.target.classList).includes(this.closeButtonClass)){e.next=4;break}return tt&&console.log("click another tab: ",n),e.next=4,this._changeNote(n);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),closeNoteByMidBtn:function(e,t){2===e.which&&t&&this.closeNote(t)},closeNote:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n,r,a,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.allNoteDirs.length<=1)){e.next=3;break}return this.editor.messager.warning("只剩最后一个标签页, 不能再关闭了"),e.abrupt("return");case 3:if(n="",t!==this.curFileDir||(r=this.allNoteDirs.indexOf(t),a=0===r?r+1:r===this.allNoteDirs.length-1?this.allNoteDirs.length-2:r+1,n=this.allNoteDirs[a]),!n){e.next=9;break}return e.next=8,this._changeNote(n);case 8:tt&&console.log("will goto this noteDir: ",n);case 9:i=this.fixedNoteDirs.indexOf(t),i>=0?(this.fixedNoteDirs.splice(i,1),tt&&console.log("close this noteDir: ",t)):t===this.tempNoteDir&&(this.tempNoteDir="");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),fixThisNoteDir:function(e){this.fixedNoteDirs.includes(e)||(this.fixedNoteDirs.length<this.maxFixedNum?(e===this.tempNoteDir&&(this.tempNoteDir=""),this.fixedNoteDirs.push(e),tt&&console.log("fix note dir: ",e)):this.editor.messager.warning("标签已满"))},calWholeDir:function(e){var t=e.split("/")[2],n=0,r=!0,a=!1,i=void 0;try{for(var o,s=this.allNoteDirs[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;c.split("/")[2]===t&&(n+=1)}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n>=2?e:""},_changeNote:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.state.editor.runCommand("SAVE",{triggerType:"SWITCH_TAB"});case 2:this.$store.commit("updateGotoThisCatalog",t.split("/").slice(0,3));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},mounted:function(){tt&&console.log("mounted")},destroyed:function(){tt&&console.log("destroyed")}},rt=nt,at=(n("be65"),Object(_["a"])(rt,Qe,Xe,!1,null,"7b2032f6",null));at.options.__file="quick-open-bar.vue";var it=at.exports,ot=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.isFileLoaded,expression:"isFileLoaded"}],ref:"editor",attrs:{id:"editor"}})},st=[],ct=(n("c5f6"),n("a481"),n("c665")),lt=n("aa9a"),ut=n("56b3"),ht=n.n(ut),dt=(n("a7be"),n("959b"),n("f9d4"),n("4ba6"),n("db91"),n("44d5"),n("02f0"),n("7b00"),n("ffda"),n("4895"),n("9f09"),n("f4ba"),n("76ae"),n("e777"),n("281e"),n("2aed"),n("d72f"),function(){function e(t,n){Object(ct["a"])(this,e),n=p.a.merge({cm:{}},n),this.el=t,this.curCursorLineNum=void 0,this.shortcutKeyMap={},this.messager=n.messager||{success:function(){},info:function(){},warning:function(){},error:function(){}},this.cm=this._init(t,n.cm),this.cm.on("change",this._onChange),this.cm.on("renderLine",this._onRenderLine.bind(this)),this.cm.on("cursorActivity",this._onCursorActivity.bind(this))}return Object(lt["a"])(e,[{key:"_init",value:function(e,t){var n={mode:{name:"text/markdown",highlightFormatting:!0,xml:!1,taskLists:!0,strikethrough:!0},theme:"paraiso-light",tabSize:4,smartIndent:!1,indentUnit:4,inputStyle:"contenteditable",addModeClass:!0,lineWrapping:!0,autoRefresh:!0,lineNumbers:!1};return"boolean"===typeof t.lineNumbers&&(n.lineNumbers=t.lineNumbers),t.tabSize&&(n.tabSize=t.tabSize),t.indentUnit&&(n.indentUnit=t.indentUnit),ht()(e,n)}},{key:"_onChange",value:function(){}},{key:"_onCursorActivity",value:function(e){var t="cursor-in-this-line",n=e.getDoc(),r=n.getCursor(),a=r.line;void 0===this.curCursorLineNum?n.addLineClass(a,"wrap",t):this.curCursorLineNum!==a&&(n.removeLineClass(this.curCursorLineNum,"wrap",t),n.addLineClass(a,"wrap",t)),this.curCursorLineNum=a}},{key:"_onRenderLine",value:function(e,t,n){var r=new Date;if(n.querySelector(".cm-formatting-header")){var a=t.text.match(/^(#+)\s/);a&&(n.classList.add("line-cm-header"),n.classList.add("line-cm-header-".concat(a[1].length)))}else if(n.querySelector(".cm-quote"))n.classList.add("line-cm-quote");else if(n.querySelector('[class^="cm-m-"]:not(.cm-m-markdown)')||n.querySelector(".cm-formatting-code-block")){n.classList.add("line-cm-code-block"),"```"===t.text.slice(0,3)&&n.classList.add("line-cm-code-block-boundary");var i=n.querySelector(".cm-comment");i&&(i.innerText.match(/^\/\//)||i.innerText.match(/^\/\*/)||i.innerText.match(/^#/))&&i.classList.add("cm-code-comment")}var o=new Date-r;o>=3&&console.warn("render line timer: ",o,n)}},{key:"on",value:function(e,t){switch(e){case"renderLine":this.cm.on("renderLine",t);break;case"change":this.cm.on("change",t);break;case"changes":this.cm.on("changes",t);break;default:console.error("unsupported event: ",e);break}}},{key:"off",value:function(e,t){switch(e){case"renderLine":this.cm.off("renderLine",t);break;case"change":this.cm.off("change",t);break;case"changes":this.cm.off("changes",t);break;default:console.error("unsupported event: ",e);break}}},{key:"use",value:function(e,t){e(this,t)}},{key:"bindShortcutKeyMap",value:function(e,t,n){if(t.length>4)throw new Error("The maximum length of keyArr is 4: ".concat(t));var r=t.join("").split("").sort().join("").toUpperCase();this.shortcutKeyMap[r]?console.warn("This shortcut key has been occupied: ",t,n,"This shortcut key corresponds to: ",this.shortcutKeyMap[r]):(this.shortcutKeyMap[r]={keyArr:t,handler:n},e.addEventListener("keydown",function(e){if(e.ctrlKey||e.altKey){var r=!0,a=0;if(e.ctrlKey&&(a+=1),e.altKey&&(a+=1),e.shiftKey&&(a+=1),t.length!==a+1)return;var i=!0,o=!1,s=void 0;try{for(var c,l=t[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var u=c.value;if("CTRL"===u.toUpperCase()&&e.ctrlKey);else if("SHIFT"===u.toUpperCase()&&e.shiftKey);else if("ALT"===u.toUpperCase()&&e.altKey);else if(u.toUpperCase()!==e.key.toUpperCase()){r=!1;break}}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}r&&(e.preventDefault(),n())}}))}},{key:"foldHeaderTo",value:function(e){var t=0;this.cm.execCommand("unfoldAll");for(var n=this.cm.getDoc(),r=n.lineCount(),a=r;a>=0;a-=1){var i=n.getLine(a);if(i){var o=this.getHeaderLvByStr(i);o&&((o>=t||o>=e)&&this.fold(a),t=o)}}}},{key:"toggleFold",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.cm.foldCode(e,{widget:"+",minFoldSize:1,scanUp:t})}},{key:"fold",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.cm.foldCode(e,{widget:"+",minFoldSize:1,scanUp:t},"fold")}},{key:"unfold",value:function(e){this.cm.foldCode(e,{widget:"+",minFoldSize:1},"unfold")}},{key:"getHeaderAncestors",value:function(e,t){var n,r=[];e||(e=this.cm.getCursor()),t||(t=99);var a=this.cm.lineInfo(e.line).text,i=this.getHeaderLvByStr(a);i&&(n={headerLv:i,headerLineNum:e.line,headerLineText:a,isCursorInThisLine:!0},r.push(n));var o=i||99,s=0,c=e.line-1;while(c>=0&&s<t&&o>=1){var l=this.cm.lineInfo(c).text,u=this.getHeaderLvByStr(l);u&&u<o&&(r.push({headerLv:u,headerLineNum:c,headerLineText:l}),o=u,s+=1),c-=1}return r}},{key:"getHeaderSiblings",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,a={};e||(e=this.cm.getCursor()),r||(r=999);var i,o,s,c=[],l={},u=[],h=0,d=this.getHeaderByCursor(e);if(!d.headerLv)return a;l.headerLv=d.headerLv,l.headerLineNum=d.headerLineNum,l.headerLineText=d.headerLineText,l.headerLineNum===e.line&&(l.isCursorInThisLine=!0);var f=!1;if(t){i=l.headerLineNum-1;while(i>=0&&!f&&h<r)o=this.cm.lineInfo(i).text,s=this.getHeaderLvByStr(o),s&&s<=l.headerLv&&(s===l.headerLv?(c.push({headerLv:s,headerLineNum:i,headerLineText:o}),h+=1):f=!0),i-=1}var g=!1;if(n){i=e.line+1;var v=this.cm.getDoc().lastLine();while(i<=v&&!g&&h<r)o=this.cm.lineInfo(i).text,s=this.getHeaderLvByStr(o),s&&s<=l.headerLv&&(s===l.headerLv?(u.push({headerLv:s,headerLineNum:i,headerLineText:o}),h+=1):g=!0),i+=1}c.reverse();var m=[l];return a={firstNextHeaderIndex:c.length+1,data:m.concat(c,u)},a}},{key:"isThisLineAHeader",value:function(e){var t=!1;if(!e){var n=this.cm.getCursor();e=n.line}var r=this.getHeaderLvByStr(this.cm.lineInfo(e).text);return r&&(t=r),t}},{key:"getHeaderLvByStr",value:function(e){var t,n=e.match(/^(#+)\s/);return n&&n[1].length>0&&(t=n[1].length),t}},{key:"getHeaderByCursor",value:function(e){if(!e){var t=this.cm.getDoc();e=t.getCursor()}var n,r=e.line,a=this.cm.lineInfo(r).text;while(r>0&&"#"!==a[0])r-=1,a=this.cm.lineInfo(r).text;return"#"===a[0]&&(n=this.getHeaderLvByStr(a)),{headerLv:n,headerLineNum:r,headerLineText:a}}},{key:"getHeadersHierarchy",value:function(e){e||(e=this.cm.getDoc().getValue());for(var t=e.split("\n"),n=[],r=[],a=0;a<t.length;a+=1){var i=t[a].match(/^(#+)\s(.+)/);if(i&&i[1].length>0){var o=i[1].length;1===o?(r[o]=[],n.push({lineNum:a,lv:o,text:i[0],children:r[o]})):o>1&&o<=6&&r[o-1]&&(r[o]=[],r[o-1].push({lineNum:a,lv:o,text:i[0],children:r[o]}))}}return n}},{key:"getHeadersArray",value:function(e){e||(e=this.cm.getDoc().getValue());for(var t=e.split("\n"),n=[],r=0;r<t.length;r+=1){var a=this.getHeaderLvByStr(t[r]);a&&a>0&&n.push({lineNum:r,lv:a,text:t[r]})}return n}},{key:"scrollNoteToThisLine",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unfoldAll",a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.cm.getDoc();"unfoldAll"===r?this.cm.execCommand("unfoldAll"):"intelligently"===r?(i.setCursor({line:e,ch:0}),this.foldPlugin.foldIntelligently(this.cm,!0)):"keepFold"===r||console.warn("Wrong parameter, unfoldWay: ",r),a&&setTimeout(function(){n.cm.focus(),i.setCursor({line:e,ch:0})},0),this.cm.scrollIntoView({line:e,ch:0},300),i.addLineClass(e,"background",t),setTimeout(function(){i.removeLineClass(e,"background",t),n.cm.scrollIntoView({line:e,ch:0},300),i.addLineClass(e,"background",t),setTimeout(function(){i.removeLineClass(e,"background",t),n.cm.scrollIntoView({line:e,ch:0},300),i.addLineClass(e,"background",t),setTimeout(function(){i.removeLineClass(e,"background",t)},200)},200)},200)}},{key:"getCmdInLastLine",value:function(e){var t=null,n=this.cm.getDoc().lastLine(),r=this.cm.lineInfo(n).text;return this.isThisLineCmdLine(n,r)&&(t=r.match(e)),t}},{key:"isThisLineCmdLine",value:function(e,t){var n,r,a,i=!1;if("number"!==typeof e)throw new Error("lineNum: wrong typte, expect a number: ".concat(e));return n=e,"string"===typeof t&&(a=n,r=t),a||(a=this.cm.getDoc().lastLine()),n===a&&(r||(r=this.cm.lineInfo(n).text),0===r.indexOf("# %")&&(i=!0)),i}}]),e}()),ft=n("1157"),gt=n.n(ft),vt=function(e,t){e.cm.on("drop",function(){var n=Object(g["a"])(regeneratorRuntime.mark(function n(r,a){var i,o;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:if(a.preventDefault(),i=a.dataTransfer.files[0],!i){n.next=7;break}return o=new FormData,o.append("file",i),n.next=7,mt(o,e,t.upload,t.messager);case 7:case"end":return n.stop()}},n,this)}));return function(e,t){return n.apply(this,arguments)}}()),e.cm.on("paste",function(){var n=Object(g["a"])(regeneratorRuntime.mark(function n(r,a){var i,o;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:if(i=new FormData,o=a.clipboardData.items[0],!o||!o.type.includes("image")){n.next=7;break}return a.preventDefault(),i.append("file",o.getAsFile()),n.next=7,mt(i,e,t.upload,t.messager);case 7:case"end":return n.stop()}},n,this)}));return function(e,t){return n.apply(this,arguments)}}()),e.cm.on("renderLine",function(t,n,r){if(n.text!==n.lastTimeText_image){n.lastTimeText_image=n.text;var a=n.text.match(/^!\[.*?\]\((.*?)\)/);if(a){var i="";i="".concat(e.fileServer.staticImageUrl),r.classList.add("line-cm-image"),setTimeout(function(){n.widgets&&n.widgets.forEach(function(e){e.clear()});var t=gt()('<img style="visibility:hidden"></img>'),r=gt()('<div class="inserted-widget-image"></div>');r.append(t),t.on("load",function(){t.css({width:"".concat(.81*t[0].naturalWidth,"px"),visibility:"visible"})}),t.attr("src",i+a[1]),e.cm.getDoc().addLineWidget(n,r[0])},0)}}})};function mt(e,t,n,r){return pt.apply(this,arguments)}function pt(){return pt=Object(g["a"])(regeneratorRuntime.mark(function e(t,n,r,a){var i,o,s,c,l,u,h,d,f;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t.set("fileDir",n.fileServer.curFileDir),e.next=3,r(t,a);case 3:i=e.sent,o=n.cm.getDoc(),s=o.getCursor(),c=s.line,l=o.getLine(c),u="",h="",f=l.length,l?s.ch===l.length?(u="\n",d=2):(u="".concat(l.slice(0,s.ch),"\n"),h=l.slice(s.ch,l.length),f=0,d=2):(u="",d=1),o.replaceRange("".concat(u,"![](").concat(i.dir,"/").concat(i.fileName,")\n").concat(h),{line:c,ch:f},{line:c,ch:l.length}),o.setCursor({line:c+d,ch:0});case 14:case"end":return e.stop()}},e,this)})),pt.apply(this,arguments)}var Ct=n("3b2f"),bt=n.n(Ct),Lt=(n("7cd2"),n("4bce"),function(e,t){e.cm.on("renderLine",function(t,n){if(n.text!==n.lastTimeText_math){n.lastTimeText_math=n.text;var r=/\$([^$]+?)\$/g,a=r.exec(n.text);if(a){var i=!1,o=e.cm.getDoc(),s=o.getCursor(),c=t.lineInfo(n).line,l=[{from:a.index,to:a.index+(a[0].length-1),text:a[1]}],u=r.exec(n.text);while(u)l.push({from:u.index,to:u.index+(u[0].length-1),text:u[1]}),u=r.exec(n.text);var h=s.ch-1;l.forEach(function(t){if(h>t.from&&h<t.to)setTimeout(function(){n.widgets&&n.widgets.forEach(function(e){e.clear()});var r=gt()(bt.a.renderToString(t.text,{throwOnError:!1}));r.addClass("ink-math-preview"),e.cm.getDoc().addLineWidget(n,r[0])},0);else{var r=gt()(bt.a.renderToString(t.text,{throwOnError:!1}));setTimeout(function(){i||(n.markedSpans&&n.markedSpans.forEach(function(e){e.marker.clear()}),i=!0),n.widgets&&n.widgets.forEach(function(e){e.clear()});var e=o.markText({line:c,ch:t.from},{line:c,ch:t.to+1},{className:"ink-math-code",replacedWith:r[0]});e.on("beforeCursorEnter",function(){e.clear()})},0)}})}}})}),wt=n("a322"),yt={foldHeaderToHeader1:"Ctrl-Alt-1",foldHeaderToHeader2:"Ctrl-Alt-2",foldHeaderToHeader3:"Ctrl-Alt-3",foldHeaderToHeader4:"Ctrl-Alt-4",foldHeaderToHeader5:"Ctrl-Alt-5",foldHeaderToHeader6:"Ctrl-Alt-6",unfoldAll:"Ctrl-Alt-0",foldCode:"Alt-M",foldIntelligently:"Alt-,"},xt=function(e){var t,n=function(t){var n=t.getCursor(),r=e.getHeaderByCursor(n);r.headerLv>0&&t.setCursor({line:r.headerLineNum,ch:r.headerLv+1}),e.toggleFold(t.getCursor())},r=function(e){e.execCommand("unfoldAll")},a=function(){e.foldHeaderTo(1)},i=function(){e.foldHeaderTo(2)},o=function(){e.foldHeaderTo(3)},s=function(){e.foldHeaderTo(4)},c=function(){e.foldHeaderTo(5)},l=function(){e.foldHeaderTo(6)},u=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.getCursor(),a=e.getHeaderAncestors(r);if(a.length>0)if(e.foldHeaderTo(2),a.reverse(),n){for(var i=0;i<a.length;i+=1)e.unfold(a[i].headerLineNum);t.scrollIntoView(null,300)}else{for(var o=0;o<a.length-1;o+=1)e.unfold(a[o].headerLineNum);var s=a[a.length-1];t.setCursor({line:s.headerLineNum,ch:s.headerLv+1}),t.scrollIntoView(null,300)}};e.cm.addKeyMap((t={},Object(wt["a"])(t,yt.foldCode,n),Object(wt["a"])(t,yt.unfoldAll,r),Object(wt["a"])(t,yt.foldHeaderToHeader1,a),Object(wt["a"])(t,yt.foldHeaderToHeader2,i),Object(wt["a"])(t,yt.foldHeaderToHeader3,o),Object(wt["a"])(t,yt.foldHeaderToHeader4,s),Object(wt["a"])(t,yt.foldHeaderToHeader5,c),Object(wt["a"])(t,yt.foldHeaderToHeader6,l),Object(wt["a"])(t,yt.foldIntelligently,u),t)),e.foldPlugin={foldCode:n,unfoldAll:r,foldHeaderToHeader1:a,foldHeaderToHeader2:i,foldHeaderToHeader3:o,foldHeaderToHeader4:s,foldHeaderToHeader5:c,foldHeaderToHeader6:l,foldIntelligently:u}},St=(n("b54a"),n("48c0"),n("f751"),function(e,t){var n,r={header1:"Ctrl-1",header2:"Ctrl-2",header3:"Ctrl-3",header4:"Ctrl-4",header5:"Ctrl-5",header6:"Ctrl-6",bold:"Ctrl-B",code:"Ctrl-;",em:"Ctrl-E",toUpperCase:"Ctrl-Alt-U",toLowerCase:"Ctrl-Alt-L",insertFencedCode:"Ctrl-Alt-F",insertImage:"Ctrl-Alt-I",insertMath:"Ctrl-Alt-M",insertNewLineUp:"Shift-Ctrl-Enter",insertNewLineDown:"Ctrl-Enter",copyCurLineDown:"Shift-Alt-Down",copyCurLineUp:"Shift-Alt-Up",exchangeCurLineUp:"Alt-Up",exchangeCurLineDown:"Alt-Down",alt:"Alt"},a=Object.assign(r,t);e.cm.addKeyMap((n={},Object(wt["a"])(n,a.header1,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getLine(n.line),a=r.match(/^#+?\s/);a&&2===a[0].length?(t.replaceRange("",{line:n.line,ch:0},{line:n.line,ch:2}),t.setCursor({line:n.line,ch:t.getLine(n.line).length})):a&&2!==a.length?t.replaceRange("# ",{line:n.line,ch:0},{line:n.line,ch:a[0].length}):(t.replaceRange("# ",{line:n.line,ch:0},{line:n.line,ch:a?a[0].length:0}),t.setCursor({line:n.line,ch:t.getLine(n.line).length}))}),Object(wt["a"])(n,a.header2,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getLine(n.line),a=r.match(/^#+?\s/);a&&3===a[0].length?(t.replaceRange("",{line:n.line,ch:0},{line:n.line,ch:3}),t.setCursor({line:n.line,ch:t.getLine(n.line).length})):a&&3!==a[0].length?t.replaceRange("## ",{line:n.line,ch:0},{line:n.line,ch:a[0].length}):(t.replaceRange("## ",{line:n.line,ch:0},{line:n.line,ch:a?a[0].length:0}),t.setCursor({line:n.line,ch:t.getLine(n.line).length}))}),Object(wt["a"])(n,a.header3,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getLine(n.line),a=r.match(/^#+?\s/);a&&4===a[0].length?(t.replaceRange("",{line:n.line,ch:0},{line:n.line,ch:4}),t.setCursor({line:n.line,ch:t.getLine(n.line).length})):a&&4!==a[0].length?t.replaceRange("### ",{line:n.line,ch:0},{line:n.line,ch:a[0].length}):(t.replaceRange("### ",{line:n.line,ch:0},{line:n.line,ch:a?a[0].length:0}),t.setCursor({line:n.line,ch:t.getLine(n.line).length}))}),Object(wt["a"])(n,a.header4,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getLine(n.line),a=r.match(/^#+?\s/);a&&5===a[0].length?(t.replaceRange("",{line:n.line,ch:0},{line:n.line,ch:5}),t.setCursor({line:n.line,ch:t.getLine(n.line).length})):a&&5!==a[0].length?t.replaceRange("#### ",{line:n.line,ch:0},{line:n.line,ch:a[0].length}):(t.replaceRange("#### ",{line:n.line,ch:0},{line:n.line,ch:a?a[0].length:0}),t.setCursor({line:n.line,ch:t.getLine(n.line).length}))}),Object(wt["a"])(n,a.header5,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getLine(n.line),a=r.match(/^#+?\s/);a&&6===a[0].length?(t.replaceRange("",{line:n.line,ch:0},{line:n.line,ch:6}),t.setCursor({line:n.line,ch:t.getLine(n.line).length})):a&&6!==a[0].length?t.replaceRange("##### ",{line:n.line,ch:0},{line:n.line,ch:a[0].length}):(t.replaceRange("##### ",{line:n.line,ch:0},{line:n.line,ch:a?a[0].length:0}),t.setCursor({line:n.line,ch:t.getLine(n.line).length}))}),Object(wt["a"])(n,a.header6,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getLine(n.line),a=r.match(/^#+?\s/);a&&7===a[0].length?(t.replaceRange("",{line:n.line,ch:0},{line:n.line,ch:7}),t.setCursor({line:n.line,ch:t.getLine(n.line).length})):a&&7!==a[0].length?t.replaceRange("###### ",{line:n.line,ch:0},{line:n.line,ch:a[0].length}):(t.replaceRange("###### ",{line:n.line,ch:0},{line:n.line,ch:a?a[0].length:0}),t.setCursor({line:n.line,ch:t.getLine(n.line).length}))}),Object(wt["a"])(n,a.bold,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getSelection();if(r){var a=r.match(/^\*\*(.*?)\*\*$/);a?t.replaceSelection(a[1]):t.replaceSelection("**".concat(r,"**"))}else t.replaceRange("**b**",n),t.setSelection({line:n.line,ch:n.ch+2},{line:n.line,ch:n.ch+3})}),Object(wt["a"])(n,a.em,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getSelection();if(r){var a=r.match(/^\*(.*?)\*$/);a?t.replaceSelection(a[1]):t.replaceSelection("*".concat(r,"*"))}else t.replaceRange("*e*",n),t.setSelection({line:n.line,ch:n.ch+1},{line:n.line,ch:n.ch+2})}),Object(wt["a"])(n,a.italic,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getSelection();if(r){var a=r.match(/^_(.*?)_$/);a?t.replaceSelection(a[1]):t.replaceSelection("_".concat(r,"_"))}else t.replaceRange("_i_",n),t.setSelection({line:n.line,ch:n.ch+1},{line:n.line,ch:n.ch+2})}),Object(wt["a"])(n,a.code,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getSelection();if(r){var a=r.match(/^`(.*?)`$/);a?t.replaceSelection(a[1]):t.replaceSelection("`".concat(r,"`"))}else t.replaceRange("`c`",n),t.setSelection({line:n.line,ch:n.ch+1},{line:n.line,ch:n.ch+2})}),Object(wt["a"])(n,a.link,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getSelection();if(r){var a=r.match(/^\[(.*?)\]$/);a?t.replaceSelection(a[1]):t.replaceSelection("[".concat(r,"]"))}else t.replaceRange("[l]",n),t.setSelection({line:n.line,ch:n.ch+1},{line:n.line,ch:n.ch+2})}),Object(wt["a"])(n,a.toUpperCase,function(e){var t=e.getDoc(),n=t.getSelection();if(n)t.replaceSelection(n.toUpperCase());else{var r=t.getCursor(),a=e.lineInfo(r.line).text;t.replaceRange(a.toUpperCase(),{line:r.line,ch:0},{line:r.line,ch:a.length})}}),Object(wt["a"])(n,a.toLowerCase,function(e){var t=e.getDoc(),n=t.getSelection();if(n)t.replaceSelection(n.toLowerCase());else{var r=t.getCursor(),a=e.lineInfo(r.line).text;t.replaceRange(a.toLowerCase(),{line:r.line,ch:0},{line:r.line,ch:a.length})}}),Object(wt["a"])(n,a.insertMath,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.getSelection();if(r){var a=r.match(/\$([^$]+?)\$$/);a?t.replaceSelection(a[1]):t.replaceSelection("$".concat(r,"$"))}else t.replaceRange("$m$",n),t.setSelection({line:n.line,ch:n.ch+1},{line:n.line,ch:n.ch+2})}),Object(wt["a"])(n,a.insertFencedCode,function(e){var t=e.getDoc(),n=t.getCursor();t.replaceRange("```\n```",n),t.setCursor({line:n.line,ch:3})}),Object(wt["a"])(n,a.insertImage,function(e){var t=e.getDoc(),n=t.getCursor();t.replaceRange("![]()",n),t.setCursor({line:n.line,ch:4})}),Object(wt["a"])(n,a.insertNewLineDown,function(e){var t=e.getDoc(),n=t.getCursor(),r=e.lineInfo(n.line).text.length;t.replaceRange("\n",{line:n.line,ch:r},{line:n.line,ch:r}),t.setCursor({line:n.line+1,ch:0})}),Object(wt["a"])(n,a.insertNewLineUp,function(e){var t=e.getDoc(),n=t.getCursor();if(n.line>0){var r=e.lineInfo(n.line-1).text.length;t.replaceRange("\n",{line:n.line-1,ch:r},{line:n.line-1,ch:r}),t.setCursor({line:n.line,ch:0})}}),Object(wt["a"])(n,a.copyCurLineUp,function(e){var t=e.getDoc(),n=t.getCursor(),r=e.lineInfo(n.line).text;t.replaceRange("".concat(r,"\n"),{line:n.line,ch:0},{line:n.line,ch:0}),t.setCursor({line:n.line,ch:n.ch})}),Object(wt["a"])(n,a.copyCurLineDown,function(e){var t=e.getDoc(),n=t.getCursor(),r=e.lineInfo(n.line).text;t.replaceRange("\n".concat(r),{line:n.line,ch:r.length},{line:n.line,ch:r.length}),t.setCursor({line:n.line+1,ch:n.ch})}),Object(wt["a"])(n,a.exchangeCurLineUp,function(e){var t=e.getDoc(),n=t.getCursor();if(n.line>0){var r=e.lineInfo(n.line).text,a=e.lineInfo(n.line-1).text;t.replaceRange(r,{line:n.line-1,ch:0},{line:n.line-1,ch:a.length}),t.replaceRange(a,{line:n.line,ch:0},{line:n.line,ch:r.length}),t.setCursor({line:n.line-1,ch:n.ch})}}),Object(wt["a"])(n,a.exchangeCurLineDown,function(e){var t=e.getDoc(),n=t.getCursor(),r=t.lastLine();if(n.line<r){var a=e.lineInfo(n.line).text,i=e.lineInfo(n.line+1).text;t.replaceRange(i,{line:n.line,ch:0},{line:n.line,ch:a.length}),t.replaceRange(a,{line:n.line+1,ch:0},{line:n.line+1,ch:i.length}),t.setCursor({line:n.line+1,ch:n.ch})}}),Object(wt["a"])(n,a.alt,function(){}),n))}),kt=(n("14b9"),n("04ff"),{insertHeaderNext:"Ctrl-J",insertHeaderChild:"Ctrl-L",insertHeaderNextParent:"Ctrl-H",insertNextLiUnderHeader:"Ctrl-O",reorderCurHeaderLi:"Ctrl-Alt-O",upgradeHeaders:"Shift-Ctrl-[",degrageHeaders:"Shift-Ctrl-]"}),Dt=function(e){var t;e.cm.addKeyMap((t={},Object(wt["a"])(t,kt.insertHeaderNext,function(t){var n=t.getDoc(),r=e.getHeaderByCursor(),a=r.headerLv,i=r.headerLineText;if(a>0){var o,s=Ot(e,t,a),c=s.nextSiblingHeaderlineNum,l=s.parentHeaderLastLineNum;c?o=c-1:l&&(o=l),console.log(i);for(var u="",h=0;h<a;h+=1)u+="#";if(u+=" ",i){var d=i.match(/^#+ (.+: |.+：)/);d&&d[1]&&(u+=d[1])}var f=t.lineInfo(o).text.length;n.replaceRange("\n".concat(u),{line:o,ch:f},{line:o,ch:f}),n.setSelection({line:o+1,ch:a+1},{line:o+1,ch:u.length})}}),Object(wt["a"])(t,kt.insertNextLiUnderHeader,function(t){var n=t.getDoc(),r=n.getCursor(),a=t.lineInfo(r.line).text,i=e.getHeaderByCursor(),o=i.headerLv,s=i.headerLineNum,c=i.headerLineText;if(o>0)if(r.line===s)n.replaceRange("\n1. ",{line:s,ch:c.length},{line:s,ch:c.length}),n.setCursor({line:s+1,ch:3});else{var l=Ot(e,t,o),u=l.nextSiblingHeaderlineNum,h=l.parentHeaderLastLineNum,d=r.line,f=a;while(d>s&&!f.match(/^\d+\.\s/))d-=1,f=t.lineInfo(d).text;if(f.match(/^\d+\.\s/)){var g,v,m=Number(f.match(/^(\d+)\.\s/)[0]);u?g=u-1:h&&(g=h),d=r.line,f="";while(d<g&&!f.match(/^\d+\.\s/))d+=1,f=t.lineInfo(d).text;var p="\n".concat(m+1,". "),C=f.match(/^(\d+)\.\s/);v=C?d-1:g;var b=t.lineInfo(v).text;n.replaceRange(p,{line:v,ch:b.length},{line:v,ch:b.length}),n.setCursor({line:v+1,ch:p.length-1})}else n.replaceRange("1. ",{line:r.line,ch:0},{line:r.line,ch:0}),n.setCursor({line:r.line,ch:3})}}),Object(wt["a"])(t,kt.reorderCurHeaderLi,function(t){var n=t.getDoc(),r=n.getSelection();if(r){var a;n.replaceSelection(r.replace(/^(\d+). /gm,function(e,t){var n;return a?(a+=1,n="".concat(a,". ")):(a=Number.parseInt(t,10),n="".concat(a,". ")),n}))}else{var i=e.getHeaderByCursor(),o=i.headerLv,s=i.headerLineNum;o||(s=-1);for(var c=n.lineCount(),l=1,u=s+1;u<c;u+=1){var h=n.getLine(u);if(h.match(/^(#+) /))break;h.match(/^\d+. /)&&(n.replaceRange(h.replace(/^\d+. /,"".concat(l,". ")),{line:u,ch:0},{line:u,ch:h.length}),l+=1)}}}),Object(wt["a"])(t,kt.insertHeaderChild,function(t){var n=t.getDoc(),r=e.getHeaderByCursor(),a=r.headerLv,i=r.headerLineNum;if(a>0){for(var o="",s=0;s<a+1;s+=1)o+="#";var c=t.lineInfo(i).text.length;n.replaceRange("\n".concat(o," "),{line:i,ch:c},{line:i,ch:c}),n.setCursor({line:i+1,ch:a+2})}}),Object(wt["a"])(t,kt.insertHeaderNextParent,function(t){var n=t.getDoc(),r=e.getHeaderByCursor(),a=r.headerLv;if(a>1){for(var i="",o=0;o<a-1;o+=1)i+="#";var s=Ot(e,t,a,!0),c=s.parentHeaderLastLineNum,l=t.lineInfo(c).text.length;n.replaceRange("\n".concat(i," "),{line:c,ch:l},{line:c,ch:l}),n.setCursor({line:c+1,ch:a})}}),Object(wt["a"])(t,kt.degrageHeaders,function(t){var n=t.getDoc(),r=n.getSelection();if(r)n.replaceSelection(o(r));else{var a=n.getCursor(),i=t.lineInfo(a.line).text;n.replaceRange(o(i),{line:a.line,ch:0},{line:a.line,ch:i.length})}function o(t){if(t.match(/^(#+) /gm))t=t.replace(/^(#+) /gm,function(e,t){return"".concat("#".repeat(t.length+1)," ")});else{var n=e.getHeaderByCursor(),r=n.headerLv;r||(r=0),t=t.replace(/^\d+. /gm,"".concat("#".repeat(r+1)," "))}return t.match(/^#{7,} /gm)&&e.messager.warning("有些标题超过6级了, 最多只支持到6级标题"),t}}),Object(wt["a"])(t,kt.upgradeHeaders,function(t){var n=t.getDoc(),r=n.getSelection();if(r)n.replaceSelection(o(r));else{var a=n.getCursor(),i=t.lineInfo(a.line).text;n.replaceRange(o(i),{line:a.line,ch:0},{line:a.line,ch:i.length})}function o(t){if(t.match(/^# /gm)&&e.messager.warning("有些标题已经是1级标题了, 将不再提升这些标题"),t.match(/^(#+) /gm))t=t.replace(/^(#+) /gm,function(e,t){return"".concat("#".repeat(t.length-1>=1?t.length-1:1)," ")});else{var n=e.getHeaderByCursor(),r=n.headerLv;r||(r=0),t=t.replace(/^\d+. /gm,"".concat("#".repeat(r)," "))}return t}}),t))};function Ot(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t.getDoc(),i=a.getCursor(),o="",s=0;s<n;s+=1)o+="#";o+=" ";var c,l,u=a.lastLine(),h=i.line,d="";while(h<u){if(h+=1,d=t.lineInfo(h).text,!r&&d.slice(0,o.length)===o){c=h;break}var f=e.getHeaderLvByStr(d);if(f<=n){l=h-1;break}}if(void 0===c&&void 0===l&&(l=u),l){e.isThisLineCmdLine(l)&&(l-=1);while(""===t.lineInfo(l).text&&l>=1)l-=1}return{nextSiblingHeaderlineNum:c,parentHeaderLastLineNum:l}}n("3b2b");var Nt={replaceLine:"Alt-N"},Tt=function(e,t){var n={},r=[];t&&(n=t,r=Object.keys(n)),e.cm.addKeyMap(Object(wt["a"])({},Nt.replaceLine,function(t){for(var a={},i=e.fileServer.curFileDir,o=0;o<r.length;o+=1)i.toLowerCase().includes(r[o].toLowerCase())&&Object.assign(a,n[r[o]]);var s=localStorage.getItem("stickyNoteContent");if(s){var c=s.split("\n"),l={},u=!1,h=!0,d=!1,g=void 0;try{for(var v,m=c[Symbol.iterator]();!(h=(v=m.next()).done);h=!0){var p=v.value;if(u&&"<==="!==p){var C=p.split(/,|:/);if(2===C.length){var b=Object(f["a"])(C,2);l[C[0]]=b[1]}else if(3===C.length){var L=Object(f["a"])(C,3);l[C[0]]=L[2];var w=Object(f["a"])(C,3);l[C[1]]=w[2]}}if("===>"===p)u=!0;else if("<==="===p)break}}catch(e){d=!0,g=e}finally{try{h||null==m.return||m.return()}finally{if(d)throw g}}Object.assign(a,l)}if(a){for(var y=t.getCursor(),x=t.getDoc(),S=t.lineInfo(y.line).text,k=S.length,D=Object.keys(a),O=0;O<D.length;O+=1)S=S.replace(new RegExp(D[O],"g"),a[D[O]]);x.replaceRange(S,{line:y.line,ch:0},{line:y.line,ch:Math.max(k,S.length)})}}))},_t={normalizeWord:"Alt-B"},It=function(e){e.cm.addKeyMap(Object(wt["a"])({},_t.normalizeWord,function(e){var t=e.getDoc(),n=t.getSelection();if(n)t.replaceSelection(Rt(n));else{var r=t.getCursor(),a=e.lineInfo(r.line).text;t.replaceRange(Rt(a),{line:r.line,ch:0},{line:r.line,ch:a.length})}}))};function Rt(e){return e.replace(/[a-zA-Z][a-zA-Z, ，]+/g,function(e){return e.replace(/[, ，]+/g,"").toLowerCase()}).replace(/大写开始，?([a-zA-Z]+)大写结束，?/g,function(e,t){return t.toUpperCase()}).replace(/全部大写，?([a-zA-Z]+)/g,function(e,t){return t.toUpperCase()}).replace(/大写，?([a-zA-Z])/g,function(e,t){return t.toUpperCase()})}var Ht=y.server.serverUrl,Ft={upload:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("uploadImage, illegal formData: ".concat(t));case 2:return e.next=4,b.a.post("".concat(Ht,"images"),t,{headers:{"content-type":"multipart/form-data"}}).then(function(e){if(200!==e.status)throw n&&n.error("Images.upload(), Bad Http Status: ".concat(e)),new Error("Images.upload(), Bad Http Status: ".concat(e));r=e.data,console.log("[image uploaded]")}).catch(function(e){throw n&&n.error("Images.upload(), Update Failed: ".concat(e)),new Error("Images.upload(), Update Failed: ".concat(e))});case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},jt=Ft,At=y.server.serverUrl,Et={get:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=null,e.next=3,b.a.get("".concat(At,"user-config"),{params:{props:t}}).then(function(e){if(200!==e.status)throw n&&n.error("getUserConfig(): Bad HTTP status: ".concat(e)),new Error("getUserConfig(): Bad HTTP status: ".concat(e));r=e.data}).catch(function(e){throw n&&n.error("getUserConfig failed: ".concat(e)),new Error("getUserConfig failed: ".concat(e))});case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},Pt=Et,Bt=(n("d91e"),{name:"editor",data:function(){return{editor:null,autoSaveTimer:null,isFileLoaded:!1,isFileContentChanged:!1,curFileDir:null,curFilePath:null,autoSaveInterval:4e4,autoFoldDelay:100,autoFoldLv:2,minAutoSaveInterval:1e4}},methods:{init:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Pt.get(["plugins","inkLineReplace"],this.$message).then(function(e){t=e}).catch(function(){t={}});case 2:this.editor=new dt(this.$refs.editor,{messager:this.$message}),this.editor.use(St),this.editor.use(xt),this.editor.use(Dt),this.editor.use(Tt,t),this.editor.use(It),this.editor.use(vt,{upload:jt.upload,messager:this.$message}),this.editor.use(Lt),this.editor.cm.addKeyMap({"Ctrl-S":function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.saveFile("MANUAL",!0);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}),this.editor.runCommand=this.runCommand,this.editor.fileServer={serverUrl:y.server.serverUrl,staticImageUrl:y.server.staticImageUrl,curFileDir:null,curFilePath:null},this.editor.cm.on("change",function(){n.isFileContentChanged=!0}),this.$store.commit("updateEditor",this.editor);case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),runCommand:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t&&"string"===typeof t){e.next=3;break}return console.warn("editor.runCommand(), 参数错误, command为空或不是string: ".concat(t)),e.abrupt("return");case 3:if(this.$store.commit("updateIsProhibitOperation",!0),"CLEAN"!==t){e.next=8;break}this.cleanEditor(),e.next=37;break;case 8:if("SAVE"!==t){e.next=18;break}if("object"!==Object(v["a"])(n)){e.next=14;break}return e.next=12,this.saveFile(n.triggerType,n.isShowSuccessInfo);case 12:e.next=16;break;case 14:return e.next=16,this.saveFile();case 16:e.next=37;break;case 18:if("OPENFILE"!==t){e.next=37;break}if("string"===typeof n){e.next=22;break}return console.error("runCommand(): 参数错误. OPEN指令需要传入要打开的文件路径作为第二个参数: ".concat(n)),e.abrupt("return");case 22:if(r=!0,e.prev=23,!this.isFileContentChanged){e.next=28;break}return this._turnOffAutoSave(),e.next=28,this.saveFile("CLOSE",!0);case 28:return e.next=30,this._loadFile(n);case 30:e.next=36;break;case 32:e.prev=32,e.t0=e["catch"](23),console.error(e.t0),r=!1;case 36:r&&(this.isFileLoaded=!0);case 37:this.$store.commit("updateIsProhibitOperation",!1);case 38:case"end":return e.stop()}},e,this,[[23,32]])}));return function(t,n){return e.apply(this,arguments)}}(),_loadFile:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("loadFile(), illegal filePath: ".concat(t));case 2:return this.autoSaveTimer&&this._turnOffAutoSave(),this.curFilePath=t,this.curFileDir=this.curFilePath.replace(/\/[^/]+?.md/,"/"),this.editor.fileServer.curFilePath=this.curFilePath,this.editor.fileServer.curFileDir=this.curFileDir,e.next=9,Y.get(t,this.$message);case 9:n=e.sent,this.editor.cm.getDoc().setValue(n||""),this.editor.cm.scrollIntoView(),this.isFileContentChanged=!1,this.editor.cm.getDoc().clearHistory(),this._turnOnAutoSave(),this._autoFold(this.curFilePath),this._markCmdLine(),this.$store.commit("updateCurFilePath",t);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),saveFile:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){var r,a,i,o,s,c,l,u,h,d=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(r=this.curFilePath,r){e.next=4;break}throw this.$message.error("save file: invalid filePath"),new Error("file-server, saveFile(), invalid filePath: ".concat(r));case 4:return t||(t="AUTO"),a=this.editor.cm.getCursor(),"AUTO"!==t&&a&&"number"===typeof a.line&&(i=this.editor.cm.getDoc().lastLine(),o=this.editor.cm.lineInfo(i).text,s=o,c="%auto-expand-line-".concat(a.line,"%"),this.editor.isThisLineCmdLine(i,o)?(l=o.match(/%auto-expand-line-(\w+)%/),l?(o=o.replace(/%auto-expand-line-\w+%/,c),this._updateCmdLine(a,o,{line:i,ch:0},{line:i,ch:s.length})):this._updateCmdLine(a," ".concat(c),{line:i,ch:o.length},{line:i,ch:o.length})):this._updateCmdLine(a,"\n# ".concat(c),{line:i,ch:o.length},{line:i,ch:o.length})),u=this.editor.cm.getValue(),e.next=10,new Promise(function(e){return setTimeout(function(){d.isFileContentChanged=!1,e()},0)});case 10:return h={path:r,data:u},e.next=13,Y.update(h,this.$message,n);case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),cleanEditor:function(){this.curFileDir=null,this.curFilePath=null,this._turnOffAutoSave();var e=this.editor.cm.getDoc();e.setValue(""),e.clearHistory(),this.isFileContentChanged=!1,this.isFileLoaded=!1},onbeforeunload:function(e){return this.isFileContentChanged&&this.curFilePath?(this.saveFile("BEFOREUNLOAD",!0),e.returnValue="has a unsaved file!","has a unsaved file!"):null},_turnOffAutoSave:function(){this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null,console.log("[close auto save]: ".concat(this.curFilePath)))},_turnOnAutoSave:function(){var e=this;if(this.autoSaveTimer)throw new Error("Another auto save timer is running: ".concat(this.autoSaveTimer));this.autoSaveInterval>0&&(this.autoSaveTimer=setInterval(Object(g["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isFileContentChanged){t.next=3;break}return t.next=3,e.saveFile("AUTO");case 3:case"end":return t.stop()}},t,this)})),this.autoSaveInterval),console.log("[start auto save]: ".concat(this.curFilePath,", interval: ").concat(this.autoSaveInterval/1e3," seconds")))},_autoFold:function(e){var t=this;"string"!==typeof e&&console.error("waitFoldPath is not a string: ".concat(e));var n=this.editor.cm.getDoc().lastLine(),r=this.editor.cm.lineInfo(n).text;function a(e,t){e.foldHeaderTo(t);var n=e.cm.getDoc().lastLine(),r=e.cm.lineInfo(n).text;if(e.isThisLineCmdLine(n,r)){var a=r.match(/%auto-expand-line-(\w+)%/);if(a){var o=Number(a[1]),s=e.getHeaderAncestors({line:o,ch:0});if(s.length>0){s.reverse();for(var c=0;c<s.length;c+=1)e.unfold(s[c].headerLineNum);var l=s[s.length-1],u=0;l.isCursorInThisLine&&(u=l.headerLv+1),i(e,o,u)}else i(e,o,0)}}}function i(e,t,n){setTimeout(function(){e.cm.focus(),e.cm.setCursor({line:t,ch:n}),e.cm.scrollIntoView(null,300)},100)}this.editor.isThisLineCmdLine(n,r)&&r.includes("%no-auto-fold%")||this.autoFoldDelay>=0&&(0===this.autoFoldDelay?a():setTimeout(function(){t.curFilePath===e&&a(t.editor,t.autoFoldLv)},this.autoFoldDelay))},_updateCmdLine:function(e,t,n,r){var a=this.editor.cm.getDoc();a.replaceRange(t,n,r),a.setCursor(e)},_markCmdLine:function(){var e=this.editor.cm.getDoc(),t=e.lastLine();this.editor.isThisLineCmdLine(t)&&e.addLineClass(t,"text","line-cm-cmd")}},mounted:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:window.addEventListener("beforeunload",this.onbeforeunload);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}),Mt=Bt,$t=Object(_["a"])(Mt,ot,st,!1,null,null,null);$t.options.__file="editor.vue";var Ut=$t.exports,Kt={name:"note-content",components:{Editor:Ut,QuickOpenBar:it},mounted:function(){}},zt=Kt,Gt=(n("e455"),Object(_["a"])(zt,qe,Ye,!1,null,"46be35aa",null));Gt.options.__file="content.vue";var Vt=Gt.exports,Wt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"status-bar"}},[n("div",{staticClass:"cur-note-path items",attrs:{title:e.notePath},on:{click:e.copyNotePath}},[e._v(e._s(e.notePath))]),n("div",{staticClass:"note-properties items",attrs:{title:"Set Current Note Properties"}},[e._v("Prop")]),n("div",{staticClass:"note-count items",attrs:{title:"Note Count: "+e.noteCount}},[e._v("Notes: "+e._s(e.noteCount))]),n("div",{staticClass:"line-count items",attrs:{title:"Line Count: "+e.lineCount}},[e._v("Lines: "+e._s(e.lineCount))]),n("div",{class:{"word-count":!0,items:!0,warning:e.wordCount>=e.recommendedMaxNumOfWords},attrs:{title:"Word Count: "+e.wordCount+(e.wordCount>=e.recommendedMaxNumOfWords?"\nThe number of words in this note exceeds "+e.recommendedMaxNumOfWords+", which may cause performance problems. It is recommended to split this note into several notes.":"")}},[e._v("Words: "+e._s(e.wordCount))])])},Zt=[],Jt=!1,qt={name:"status-bar",data:function(){return{editor:null,wordCount:0,lineCount:0,noteCount:0,notePath:"",updateTimer:null,updateDelay:2e3,changeSeasonTimeInterval:3e3,recommendedMaxNumOfWords:3e4,season:"",time:"",curSeasonTimeType:"season",seasonTimeTypes:["season","time","icon"],seasonTimeIcons:["___spring1___","___summer1___","___autumn1___","___winter___"],seasonTimeIcon:""}},watch:{"$store.state.editor":function(e){e&&(this.editor=e,this.editor.on("changes",this.changesHandler))},"$store.state.catalog":{immediate:!0,deep:!0,handler:function(e){e&&this.editor&&this.editor.catalogPlugin&&(this.noteCount=this.editor.catalogPlugin.getNoteCount())}},"$store.state.curFilePath":function(e){e&&(this.notePath=e.replace(/\/[^/]+.md/,""))}},methods:{changesHandler:function(){var e=this;clearTimeout(this.updateTimer),this.updateTimer=setTimeout(function(){e.getWordAndLineCount()},this.updateDelay)},getWordAndLineCount:function(){var e=new Date,t=this.editor.cm.getDoc(),n=t.getValue();this.wordCount=n.length,this.lineCount=t.lineCount();var r=0;n=n.replace(/\b[a-zA-Z-]+\b/g,function(){return r+=1,""}),n=n.replace(/\s+/g,""),this.wordCount=n.length+r;var a=new Date-e;a>10&&console.warn("It took too long to update word count: ",a),Jt&&console.log("cumulative update consumption: ",a)},copyNotePath:function(){var e=this.notePath,t=gt()("<textarea>".concat(e,"</textarea>"));gt()("body").append(t),t[0].select(),document.execCommand("Copy"),t.remove()}}},Yt=qt,Qt=(n("08e2"),Object(_["a"])(Yt,Wt,Zt,!1,null,"567bda3b",null));Qt.options.__file="status-bar.vue";var Xt=Qt.exports,en=n("2f62");r["default"].use(en["a"]);var tn=new en["a"].Store({state:{editor:null,isProhibitOperation:!1,curFilePath:null,userConfig:null,catalog:null,gotoThisCatalog:[]},mutations:{updateEditor:function(e,t){e.editor=t},updateIsProhibitOperation:function(e,t){e.isProhibitOperation=t,window.IS_PORHIBIT_KEY_DOWN=t},updateCurFilePath:function(e,t){e.curFilePath=t},updateUserConfig:function(e,t){e.userConfig=t},updateCatalog:function(e,t){e.catalog=t},updateGotoThisCatalog:function(e,t){e.gotoThisCatalog=t}},actions:{}}),nn={name:"note",store:tn,components:{SideBar:Je,NoteContent:Vt,StatusBar:Xt},data:function(){return{staticIconUrl:y.server.staticIconUrl,isShowBgImg:!1,bgImgName:y.bgImgName,bgImgFormat:"jpg",isZenMode:!1,isShowSideBar:!0,isShowStatusBar:!0}},methods:{imgLoadError:function(e){"jpg"===this.bgImgFormat?(this.bgImgFormat="png",e.target.src="".concat(this.staticIconUrl).concat(this.bgImgName,".").concat(this.bgImgFormat)):"png"===this.bgImgFormat?(this.bgImgFormat="gif",e.target.src="".concat(this.staticIconUrl).concat(this.bgImgName,".").concat(this.bgImgFormat)):e.target.style.visibility="hidden"},bindHotKey:function(){var e=this;document.addEventListener("keydown",function(t){t.ctrlKey&&191===t.keyCode&&(t.preventDefault(),e.toggleZenMode())})},toggleZenMode:function(){this.isZenMode?(this.isShowSideBar=!0,this.isShowStatusBar=!0,localStorage.setItem("isZenMode","OFF")):(this.isShowSideBar=!1,this.isShowStatusBar=!1,localStorage.setItem("isZenMode","ON")),this.isZenMode=!this.isZenMode}},created:function(){var e=localStorage.getItem("isZenMode");e&&(this.isZenMode=!("ON"===e),this.toggleZenMode())},mounted:function(){var e=this;this.$refs.modal.addEventListener("keydown",function(e){if(window.IS_PORHIBIT_KEY_DOWN)return e.stopPropagation(),e.preventDefault(),!1}),this.bindHotKey(),setTimeout(function(){e.isShowBgImg=!0},300)}},rn=nn,an=(n("5c0b"),Object(_["a"])(rn,s,c,!1,null,null,null));an.options.__file="App.vue";var on=an.exports;r["default"].use(o["a"]);var sn=new o["a"]({routes:[{path:"/",name:"app",component:on}]});n("21af");r["default"].use(i.a),r["default"].config.productionTip=!1,new r["default"]({router:sn,store:tn,render:function(e){return e(on)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";var r=n("2856"),a=n.n(r);a.a},"5e15":function(e,t,n){"use strict";var r=n("7920"),a=n.n(r);a.a},"5fca":function(e,t,n){"use strict";var r=n("9ef6"),a=n.n(r);a.a},7135:function(e,t,n){},7920:function(e,t,n){},"7c5d":function(e,t,n){},"97ad":function(e,t,n){},"9ef6":function(e,t,n){},a19a:function(e,t,n){"use strict";var r=n("2b04"),a=n.n(r);a.a},a533:function(e,t,n){"use strict";var r=n("97ad"),a=n.n(r);a.a},a85f:function(e,t,n){"use strict";var r=n("e68a"),a=n.n(r);a.a},be65:function(e,t,n){"use strict";var r=n("1c24"),a=n.n(r);a.a},d081:function(e,t,n){},d559:function(e,t,n){},d91e:function(e,t,n){},e455:function(e,t,n){"use strict";var r=n("7c5d"),a=n.n(r);a.a},e68a:function(e,t,n){},f4fc:function(e,t,n){},fbad:function(e,t,n){"use strict";var r=n("f4fc"),a=n.n(r);a.a}});
//# sourceMappingURL=app.e3869c42.js.map